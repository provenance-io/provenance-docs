"use strict";(self.webpackChunkprovenance_blockchain_developer_portal=self.webpackChunkprovenance_blockchain_developer_portal||[]).push([[9245],{23276:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var r=t(85893),n=t(11151);const i={},a="Exchange Concepts",d={id:"sdk/exchange/concepts",title:"Exchange Concepts",description:"The x/exchange module facilitates the trading of on-chain assets.",source:"@site/docs/sdk/exchange/01_concepts.md",sourceDirName:"sdk/exchange",slug:"/sdk/exchange/concepts",permalink:"/docs/sdk/exchange/concepts",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"documentationSidebar",previous:{title:"x/exchange",permalink:"/docs/sdk/exchange/"},next:{title:"Exchange State",permalink:"/docs/sdk/exchange/state"}},l={},c=[{value:"Markets",id:"markets",level:2},{value:"Required Attributes",id:"required-attributes",level:3},{value:"Market Permissions",id:"market-permissions",level:3},{value:"Settlement",id:"settlement",level:3},{value:"Orders",id:"orders",level:2},{value:"Ask Orders",id:"ask-orders",level:3},{value:"Bid Orders",id:"bid-orders",level:3},{value:"Partial Orders",id:"partial-orders",level:3},{value:"External IDs",id:"external-ids",level:3},{value:"Fees",id:"fees",level:2},{value:"Order Creation Fees",id:"order-creation-fees",level:3},{value:"Settlement Flat Fees",id:"settlement-flat-fees",level:3},{value:"Settlement Ratio Fees",id:"settlement-ratio-fees",level:3},{value:"Seller Settlement Ratio Fee",id:"seller-settlement-ratio-fee",level:4},{value:"Buyer Settlement Ratio Fee",id:"buyer-settlement-ratio-fee",level:4},{value:"Exchange Fees",id:"exchange-fees",level:3}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,n.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{id:"exchange-concepts",children:"Exchange Concepts"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"x/exchange"})," module facilitates the trading of on-chain assets."]}),"\n",(0,r.jsx)(s.p,{children:"Markets provide fee structures and are responsible for identifying and triggering settlements.\nOrders are created by users to indicate a desire to trade on-chain funds in a market.\nThe exchange module defines a portion of market fees to be paid to the chain (distributed like gas fees)."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"#markets",children:"Markets"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#required-attributes",children:"Required Attributes"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#market-permissions",children:"Market Permissions"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#settlement",children:"Settlement"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"#orders",children:"Orders"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#ask-orders",children:"Ask Orders"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#bid-orders",children:"Bid Orders"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#partial-orders",children:"Partial Orders"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#external-ids",children:"External IDs"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"#fees",children:"Fees"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#order-creation-fees",children:"Order Creation Fees"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#settlement-flat-fees",children:"Settlement Flat Fees"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#settlement-ratio-fees",children:"Settlement Ratio Fees"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#exchange-fees",children:"Exchange Fees"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"markets",children:"Markets"}),"\n",(0,r.jsxs)(s.p,{children:["A market is a combination of on-chain setup and off-chain processes.\nThey are created by a governance proposal using the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#msggovcreatemarketrequest",children:"MsgGovCreateMarketRequest"})," message.\nMost aspects of the market are then manageable using permissioned endpoints.\nFees can only be managed with a governance proposal using the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#msggovmanagefeesrequest",children:"MsgGovManageFeesRequest"})," message."]}),"\n",(0,r.jsx)(s.p,{children:"Each market has a set of optional details designed for human-use, e.g. name, description, website url."}),"\n",(0,r.jsx)(s.p,{children:"A market is responsible (off-chain) for identifying order matches and triggering (on-chain) settlement."}),"\n",(0,r.jsx)(s.p,{children:"A market receives fees for order creation and order settlement. It also defines what fees are required and what is acceptable as payments."}),"\n",(0,r.jsxs)(s.p,{children:["A market can delegate various ",(0,r.jsx)(s.a,{href:"#market-permissions",children:"permissions"})," to other accounts, allowing those accounts to use specific endpoints on behalf of the market."]}),"\n",(0,r.jsxs)(s.p,{children:["Markets can restrict who can create orders with them by defining account attributes that are required to create orders. See ",(0,r.jsx)(s.a,{href:"#required-attributes",children:"Required Attributes"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["Markets can control whether user-settlement is allowed.\nWhen user-settlement is allowed, the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#fillbids",children:"FillBids"})," and ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#fillasks",children:"FillAsks"})," endpoints can be used for orders in the market."]}),"\n",(0,r.jsx)(s.p,{children:"A market can also control whether orders can be created for it.\nWhen order creation is not allowed, any existing orders can still be settled or cancelled, but no new ones can be made (in that market)."}),"\n",(0,r.jsxs)(s.p,{children:["The fees collected by a market are kept in the market's account, and can be accessed using the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketwithdraw",children:"MarketWithdraw"})," endpoint."]}),"\n",(0,r.jsxs)(s.p,{children:["See also: ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#market",children:"Market"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"required-attributes",children:"Required Attributes"}),"\n",(0,r.jsx)(s.p,{children:"There is a separate list of attributes required to create each order type.\nIf one or more attributes are required to create an order of a certain type, the order creator (buyer or seller) must have all of them on their account."}),"\n",(0,r.jsxs)(s.p,{children:["Required attributes can have a wildcard at the start to indicate that any attribute with the designated base and one (or more) level(s) is applicable.\nThe only place a wildcard ",(0,r.jsx)(s.code,{children:"*"})," is allowed is at the start of the string and must be immediately followed by a period.\nFor example, a required attribute of ",(0,r.jsx)(s.code,{children:"*.kyc.pb"})," would match an account attribute of ",(0,r.jsx)(s.code,{children:"buyer.kyc.pb"})," or ",(0,r.jsx)(s.code,{children:"special.seller.kyc.pb"}),", but not ",(0,r.jsx)(s.code,{children:"buyer.xkyc.pb"})," (wrong base) or ",(0,r.jsx)(s.code,{children:"kyc.pb"})," (no extra level)."]}),"\n",(0,r.jsxs)(s.p,{children:["Attributes are defined using the ",(0,r.jsx)(s.a,{href:"/x/name/spec/README.md",children:"x/name"})," module, and are managed on accounts using the ",(0,r.jsx)(s.a,{href:"/x/attribute/spec/README.md",children:"x/attributes"})," module."]}),"\n",(0,r.jsx)(s.h3,{id:"market-permissions",children:"Market Permissions"}),"\n",(0,r.jsxs)(s.p,{children:["The different available permissions are defined by the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#permission",children:"Permission"})," proto enum message."]}),"\n",(0,r.jsxs)(s.p,{children:["Each market manages its own set of ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#accessgrant",children:"AccessGrants"}),", which confer specific permissions to specific addresses."]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PERMISSION_UNSPECIFIED"}),": it is an error to try to use this permission for anything."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PERMISSION_SETTLE"}),": accounts with this permission can use the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketsettle",children:"MarketSettle"})," endpoint for a market."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PERMISSION_SET_IDS"}),": accounts with this permission can use the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketsetorderexternalid",children:"MarketSetOrderExternalID"})," endpoint for a market."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PERMISSION_CANCEL"}),": accounts with this permission can use the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#cancelorder",children:"CancelOrder"})," endpoint to cancel orders in a market."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PERMISSION_WITHDRAW"}),": accounts with this permission can use the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketwithdraw",children:"MarketWithdraw"})," endpoint for a market."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PERMISSION_UPDATE"}),": accounts with this permission can use the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketupdatedetails",children:"MarketUpdateDetails"}),", ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketupdateenabled",children:"MarketUpdateEnabled"}),", and ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketupdateusersettle",children:"MarketUpdateUserSettle"})," endpoints for a market."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PERMISSION_PERMISSIONS"}),": accounts with this permission can use the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketmanagepermissions",children:"MarketManagePermissions"})," endpoint for a market."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PERMISSION_ATTRIBUTES"}),": accounts with this permission can use the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketmanagereqattrs",children:"MarketManageReqAttrs"})," endpoint for a market."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"settlement",children:"Settlement"}),"\n",(0,r.jsxs)(s.p,{children:["Each market is responsible for the settlement of its orders.\nTo do this, it must first identify a matching set of asks and bids.\nThe ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketsettle",children:"MarketSettle"})," endpoint is then used to settle and clear orders.\nIf the market allows, users can also settlement orders with their own funds using the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#fillbids",children:"FillBids"})," or ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#fillasks",children:"FillAsks"})," endpoints."]}),"\n",(0,r.jsxs)(s.p,{children:["During settlement, at most one order can be partially filled, and it must be the last order in its list (in ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#msgmarketsettlerequest",children:"MsgMarketSettleRequest"}),").\nThat order must allow partial settlement (defined at order creation) and be evenly divisible (see ",(0,r.jsx)(s.a,{href:"#partial-orders",children:"Partial Orders"}),").\nThe market must also set the ",(0,r.jsx)(s.code,{children:"expect_partial"})," field to ",(0,r.jsx)(s.code,{children:"true"})," in the request.\nIf all of the orders are being filled in full, the ",(0,r.jsx)(s.code,{children:"expect_partial"})," field must be ",(0,r.jsx)(s.code,{children:"false"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["All orders in a settlement must have the same ",(0,r.jsx)(s.code,{children:"assets"})," denoms, and also the same ",(0,r.jsx)(s.code,{children:"price"})," denoms, but the fees can be anything.\nThe total bid price must be at least the total ask price (accounting for partial fulfillment if applicable)."]}),"\n",(0,r.jsx)(s.p,{children:"During settlement:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["The ",(0,r.jsx)(s.code,{children:"assets"})," are transferred directly from the seller(s) to the buyer(s)."]}),"\n",(0,r.jsxs)(s.li,{children:["The ",(0,r.jsx)(s.code,{children:"price"})," funds are transferred directly from the buyer(s) to the seller(s)."]}),"\n",(0,r.jsx)(s.li,{children:"All settlement fees are transferred directly from the seller(s) and buyer(s) to the market."}),"\n",(0,r.jsx)(s.li,{children:"The exchange's portion of the fees is transferred from the market to the chain's fee collector."}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["With complex settlements, it's possible that an ask order's ",(0,r.jsx)(s.code,{children:"assets"})," go to a different account than the ",(0,r.jsx)(s.code,{children:"price"})," funds come from, and vice versa for bid orders."]}),"\n",(0,r.jsxs)(s.p,{children:["Transfers of the ",(0,r.jsx)(s.code,{children:"assets"})," and ",(0,r.jsx)(s.code,{children:"price"})," bypass the quarantine module since order creation can be viewed as acceptance of those funds."]}),"\n",(0,r.jsxs)(s.p,{children:["Transfers do not bypass any other send-restrictions (e.g. ",(0,r.jsx)(s.code,{children:"x/marker"})," or ",(0,r.jsx)(s.code,{children:"x/sanction"})," module restrictions).\nE.g. If an order's funds are in a sanctioned account, settlement of that order will fail since those funds cannot be removed from that account.\nOr, if a marker has required attributes, but the recipient does not have those attributes, settlement will fail."]}),"\n",(0,r.jsx)(s.h2,{id:"orders",children:"Orders"}),"\n",(0,r.jsx)(s.p,{children:"Orders are created by users that want to trade assets in a market."}),"\n",(0,r.jsx)(s.p,{children:"When an order is created, a hold is placed on the applicable funds.\nThose funds will remain in the user's account until the order is settled or cancelled.\nThe holds ensure that the required funds are available at settlement without the need of an intermediary holding/clearing account.\nDuring settlement, the funds get transferred directly between the buyers and sellers, and fees are paid from the buyers and sellers directly to the market."}),"\n",(0,r.jsx)(s.p,{children:"Orders can be cancelled by either the user or the market."}),"\n",(0,r.jsx)(s.p,{children:"Once an order is created, it cannot be modified except in these specific ways:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"When an order is partially filled, the amounts in it will be reduced accordingly."}),"\n",(0,r.jsx)(s.li,{children:"An order's external id can be changed by the market."}),"\n",(0,r.jsx)(s.li,{children:"Cancelling an order will release the held funds and delete the order."}),"\n",(0,r.jsx)(s.li,{children:"Settling an order in full will delete the order."}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"ask-orders",children:"Ask Orders"}),"\n",(0,r.jsxs)(s.p,{children:["Ask orders represent a desire to sell some specific ",(0,r.jsx)(s.code,{children:"assets"})," at a minimum ",(0,r.jsx)(s.code,{children:"price"}),".\nWhen an ask order is created, a hold is placed on the ",(0,r.jsx)(s.code,{children:"assets"})," being sold.\nIf the denom of the ",(0,r.jsx)(s.code,{children:"seller_settlement_flat_fee"})," is different from the denom of the price, a hold is placed on that flat fee too.\nIt's possible for an ask order to be filled at a larger ",(0,r.jsx)(s.code,{children:"price"})," than initially defined."]}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"seller_settlement_flat_fee"})," is verified at the time of order creation, but only paid during settlement."]}),"\n",(0,r.jsxs)(s.p,{children:["When an ask order is settled, the ",(0,r.jsx)(s.code,{children:"assets"})," are transferred directly to the buyer(s) and the ",(0,r.jsx)(s.code,{children:"price"})," is transferred directly from the buyer(s).\nThen the seller settlement fees are transferred from the seller to the market."]}),"\n",(0,r.jsxs)(s.p,{children:["During settlement, the seller settlement fee ratio with the appropriate ",(0,r.jsx)(s.code,{children:"price"})," denom is applied to the price the seller is receiving.\nThat result is then added to the ask order's ",(0,r.jsx)(s.code,{children:"seller_settlement_flat_fee"})," to get the total settlement fee to be paid for the ask order.\nIn this way, the seller's settlement ratio fee can be taken out of the ",(0,r.jsx)(s.code,{children:"price"})," funds that the seller is receiving.\nIf the ",(0,r.jsx)(s.code,{children:"seller_settlement_flat_fee"})," is the same denom as the price, it can come out of the ",(0,r.jsx)(s.code,{children:"price"})," funds too."]}),"\n",(0,r.jsxs)(s.p,{children:["Because the fees can come out of the ",(0,r.jsx)(s.code,{children:"price"})," funds, it's possible (probable) that the total ",(0,r.jsx)(s.code,{children:"price"})," funds that the seller ends up with, is less than their requested price."]}),"\n",(0,r.jsxs)(s.p,{children:["For example, a user creates an ask order to sell ",(0,r.jsx)(s.code,{children:"2cow"})," (the ",(0,r.jsx)(s.code,{children:"assets"}),") and wants at least ",(0,r.jsx)(s.code,{children:"15chicken"})," (the ",(0,r.jsx)(s.code,{children:"price"}),").\nThe market finds a way to settle that order where the seller will get ",(0,r.jsx)(s.code,{children:"16chicken"}),", but the seller's settlement fee will end up being ",(0,r.jsx)(s.code,{children:"2chicken"}),".\nDuring settlement, the ",(0,r.jsx)(s.code,{children:"2cow"})," are transferred from the seller to the buyer, and ",(0,r.jsx)(s.code,{children:"16chicken"})," are transferred from the buyer to the seller.\nThen, ",(0,r.jsx)(s.code,{children:"2chicken"})," are transferred from the seller to the market.\nSo the seller ends up with ",(0,r.jsx)(s.code,{children:"14chicken"})," for their ",(0,r.jsx)(s.code,{children:"2cow"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["See also: ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#askorder",children:"AskOrder"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"bid-orders",children:"Bid Orders"}),"\n",(0,r.jsxs)(s.p,{children:["Bid orders represent a desire to buy some specific ",(0,r.jsx)(s.code,{children:"assets"})," at a specific ",(0,r.jsx)(s.code,{children:"price"}),".\nWhen a bid order is created, a hold is placed on the order's ",(0,r.jsx)(s.code,{children:"price"})," and ",(0,r.jsx)(s.code,{children:"buyer_settlement_fees"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["When a bid order is settled, the ",(0,r.jsx)(s.code,{children:"price"})," is transferred directly to the seller(s) and the assets are transferred directly from the seller(s).\nThen, the buyer settlement fees are transferred from the buyer to the market."]}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"buyer_settlement_fees"})," are verified at the time of order creation, but only paid during settlement.\nThey are paid in addition to the ",(0,r.jsx)(s.code,{children:"price"})," the buyer is paying."]}),"\n",(0,r.jsxs)(s.p,{children:["See also: ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#bidorder",children:"BidOrder"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"partial-orders",children:"Partial Orders"}),"\n",(0,r.jsxs)(s.p,{children:["Both Ask orders and Bid orders can optionally allow partial fulfillment by setting the ",(0,r.jsx)(s.code,{children:"allow_partial"})," field to ",(0,r.jsx)(s.code,{children:"true"})," when creating the order."]}),"\n",(0,r.jsxs)(s.p,{children:["When an order is partially filled, the order's same ",(0,r.jsx)(s.code,{children:"assets:price"})," and ",(0,r.jsx)(s.code,{children:"assets:settlement-fees"})," ratios are maintained."]}),"\n",(0,r.jsx)(s.p,{children:"Since only whole numbers are allowed, this means that:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"<order price> * <assets filled> / <order assets>"})," must be a whole number."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"<settlement fees> * <assets filled> / <order assets>"})," must also be a whole number."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["When an ask order is partially filled, it's ",(0,r.jsx)(s.code,{children:"price"})," and ",(0,r.jsx)(s.code,{children:"seller_settlement_flat_fee"})," are reduced at the same rate as the assets, even if the seller is receiving a higher price than requested.\nE.g. If an ask order selling ",(0,r.jsx)(s.code,{children:"2cow"})," for ",(0,r.jsx)(s.code,{children:"10chicken"})," is partially settled for ",(0,r.jsx)(s.code,{children:"1cow"})," at a price of ",(0,r.jsx)(s.code,{children:"6chicken"}),", the seller will receive the ",(0,r.jsx)(s.code,{children:"6chicken"})," but the updated ask order will list that there's still ",(0,r.jsx)(s.code,{children:"1cow"})," for sale for ",(0,r.jsx)(s.code,{children:"5chicken"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"When an order is partially filled, its amounts are updated to reflect what hasn't yet been filled."}),"\n",(0,r.jsx)(s.p,{children:"An order that allows partial fulfillment can be partially filled multiple times (as long as the numbers allow for it)."}),"\n",(0,r.jsxs)(s.p,{children:["Settlement will fail if an order is being partially filled that either doesn't allow it, or cannot be evenly split at the needed ",(0,r.jsx)(s.code,{children:"assets"})," amount."]}),"\n",(0,r.jsx)(s.h3,{id:"external-ids",children:"External IDs"}),"\n",(0,r.jsxs)(s.p,{children:["Orders can be identified using an off-chain identifier.\nThese can be provided during order creation (in the ",(0,r.jsx)(s.code,{children:"external_id"})," field).\nThey can also be set by the market after the order has been created using the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketsetorderexternalid",children:"MarketSetOrderExternalID"})," endpoint."]}),"\n",(0,r.jsxs)(s.p,{children:["Each external id is unique inside a market.\nI.e. two orders in the same market cannot have the same external id, but two orders in different markets ",(0,r.jsx)(s.strong,{children:"can"})," have the same external id.\nAn attempt (by a user) to create an order with a duplicate external id, will fail.\nAn attempt (by a market) to change an order's external id to one already in use, will fail."]}),"\n",(0,r.jsxs)(s.p,{children:["The external ids are optional, so it's possible that multiple orders in a market have an empty string for the external id.\nOrders with external ids can be looked up using the ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/queries#getorderbyexternalid",children:"GetOrderByExternalID"})," query (as well as the other order queries)."]}),"\n",(0,r.jsx)(s.p,{children:"External ids are limited to 100 characters."}),"\n",(0,r.jsx)(s.h2,{id:"fees",children:"Fees"}),"\n",(0,r.jsx)(s.p,{children:"Markets dictate the minimum required fees. It's possible to pay more than the required fees, but not less."}),"\n",(0,r.jsxs)(s.p,{children:["A portion of the fees that a market collects are sent to the blockchain and distributed similar to gas fees.\nThis portion is dictated by the exchange module in its ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/params",children:"params"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"There are three types of fees:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Order creation: Flat fees paid at the time that an order is created."}),"\n",(0,r.jsx)(s.li,{children:"Settlement flat fees: A fee paid during settlement that is the same for each order."}),"\n",(0,r.jsx)(s.li,{children:"Settlement ratio fees: A fee paid during settlement that is based off of the order's price."}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"For each fee type, there is a configuration for each order type.\nE.g. the ask-order creation fee is configured separately from the bid-order creation fee."}),"\n",(0,r.jsxs)(s.p,{children:["Each fee type is only paid in a single denom, but a market can define multiple options for each.\nE.g. if flat fee options for a specific fee are ",(0,r.jsx)(s.code,{children:"5chicken,1cow"}),", users can provide ",(0,r.jsx)(s.strong,{children:"either"})," ",(0,r.jsx)(s.code,{children:"5chicken"})," or ",(0,r.jsx)(s.code,{children:"1cow"})," to fulfill that required fee."]}),"\n",(0,r.jsxs)(s.p,{children:["If a market does not have any options defined for a given fee type, that fee is not required.\nE.g. if the ",(0,r.jsx)(s.code,{children:"fee_create_ask_flat"})," field is empty, there is no fee required to create an ask order."]}),"\n",(0,r.jsx)(s.p,{children:"All fees except the seller settlement ratio fees must be provided with order creation, and are validated at order creation."}),"\n",(0,r.jsx)(s.h3,{id:"order-creation-fees",children:"Order Creation Fees"}),"\n",(0,r.jsxs)(s.p,{children:["This is a fee provided in the ",(0,r.jsx)(s.code,{children:"order_creation_fee"})," field of the order creation ",(0,r.jsx)(s.code,{children:"Msg"}),"s and is collected immediately.\nThese are paid on top of any gas or message fees required."]}),"\n",(0,r.jsx)(s.p,{children:"Each order type has its own creation fee configuration:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"fee_create_ask_flat"}),": The available ",(0,r.jsx)(s.code,{children:"Coin"})," fee options for creating an ask order."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"fee_create_bid_flat"}),": The available ",(0,r.jsx)(s.code,{children:"Coin"})," fee options for creating a bid order."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"settlement-flat-fees",children:"Settlement Flat Fees"}),"\n",(0,r.jsx)(s.p,{children:"This is a fee provided as part of an order, but is not collected until settlement."}),"\n",(0,r.jsx)(s.p,{children:"Each order type has its own settlement flat fee configuration:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"fee_seller_settlement_flat"}),": The available ",(0,r.jsx)(s.code,{children:"Coin"})," fee options that are paid by the seller during settlement."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"fee_buyer_settlement_flat"}),": The available ",(0,r.jsx)(s.code,{children:"Coin"})," fee options that are paid by the buyer during settlement."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["The ask order's ",(0,r.jsx)(s.code,{children:"seller_settlement_flat_fee"})," must be at least one of the available ",(0,r.jsx)(s.code,{children:"fee_seller_settlement_flat"})," options.\nThe bid order's ",(0,r.jsx)(s.code,{children:"buyer_settlement_fees"})," must be enough to cover one of the ",(0,r.jsx)(s.code,{children:"fee_buyer_settlement_flat"})," options plus one of the buyer settlement ratio fee options."]}),"\n",(0,r.jsx)(s.h3,{id:"settlement-ratio-fees",children:"Settlement Ratio Fees"}),"\n",(0,r.jsxs)(s.p,{children:["A ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#feeratio",children:"FeeRatio"})," is a pair of ",(0,r.jsx)(s.code,{children:"Coin"}),"s defining a ",(0,r.jsx)(s.code,{children:"price"})," to ",(0,r.jsx)(s.code,{children:"fee"})," ratio."]}),"\n",(0,r.jsx)(s.p,{children:"Each order type has its own settlement ratio fee configurations:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"fee_seller_settlement_ratios"}),": The available ",(0,r.jsx)(s.code,{children:"FeeRatio"})," options that are applied to the ",(0,r.jsx)(s.code,{children:"price"})," received."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"fee_buyer_settlement_ratios"}),": The available ",(0,r.jsx)(s.code,{children:"FeeRatio"})," options that are applied to the bid order's ",(0,r.jsx)(s.code,{children:"price"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["If a market defines both buyer and seller settlement ratios, they should define ratios in each with the same set of ",(0,r.jsx)(s.code,{children:"price"})," denoms.\nE.g. if there's a ",(0,r.jsx)(s.code,{children:"fee_buyer_settlement_ratios"})," entry of ",(0,r.jsx)(s.code,{children:"100chicken:1cow"}),", there should be an entry in ",(0,r.jsx)(s.code,{children:"fee_seller_settlement_ratios"})," with a price denom of ",(0,r.jsx)(s.code,{children:"chicken"})," (or ",(0,r.jsx)(s.code,{children:"fee_seller_settlement_ratios"})," should be empty)."]}),"\n",(0,r.jsxs)(s.p,{children:["If a market requires both, but there's a price denom in the ",(0,r.jsx)(s.code,{children:"fee_buyer_settlement_ratios"})," that isn't in ",(0,r.jsx)(s.code,{children:"fee_seller_settlement_ratios"}),", then orders with that denom in their ",(0,r.jsx)(s.code,{children:"price"})," cannot be settled.\nIf a market requires both, but there's a price denom in the ",(0,r.jsx)(s.code,{children:"fee_seller_settlement_ratios"})," that isn't in ",(0,r.jsx)(s.code,{children:"fee_buyer_settlement_ratios"}),", then bid orders with that denom in their ",(0,r.jsx)(s.code,{children:"price"})," cannot be created, so ask orders with that price denom will have nothing to settle with."]}),"\n",(0,r.jsxs)(s.p,{children:["A ",(0,r.jsx)(s.code,{children:"FeeRatio"})," can have a zero ",(0,r.jsx)(s.code,{children:"fee"})," amount (but not a zero ",(0,r.jsx)(s.code,{children:"price"})," amount), e.g. ",(0,r.jsx)(s.code,{children:"1chicken:0chicken"})," is okay, but ",(0,r.jsx)(s.code,{children:"0chicken:1chicken"})," is bad.\nThis allows a market to not charge a ratio fee for a specific ",(0,r.jsx)(s.code,{children:"price"})," denom."]}),"\n",(0,r.jsxs)(s.p,{children:["A ",(0,r.jsx)(s.code,{children:"FeeRatio"})," with the same ",(0,r.jsx)(s.code,{children:"price"})," and ",(0,r.jsx)(s.code,{children:"fee"})," denoms must have a larger price amount than fee amount."]}),"\n",(0,r.jsx)(s.h4,{id:"seller-settlement-ratio-fee",children:"Seller Settlement Ratio Fee"}),"\n",(0,r.jsxs)(s.p,{children:["A market's ",(0,r.jsx)(s.code,{children:"fee_seller_settlement_ratios"})," are limited to ",(0,r.jsx)(s.code,{children:"FeeRatio"}),"s that have the same ",(0,r.jsx)(s.code,{children:"price"})," and ",(0,r.jsx)(s.code,{children:"fee"})," denom.\nThis ensures that the seller settlement fee can always be paid by the funds the seller is receiving."]}),"\n",(0,r.jsxs)(s.p,{children:["To calculate the seller settlement ratio fee, the following formula is used: ",(0,r.jsx)(s.code,{children:"<settlement price> * <ratio fee> / <ratio price>"}),".\nIf that is not a whole number, it is rounded up to the next whole number."]}),"\n",(0,r.jsxs)(s.p,{children:["E.g. A market has ",(0,r.jsx)(s.code,{children:"1000chicken:3chicken"})," in ",(0,r.jsx)(s.code,{children:"fee_seller_settlement_ratios"}),"."]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["An order is settling for ",(0,r.jsx)(s.code,{children:"400chicken"}),": ",(0,r.jsx)(s.code,{children:"400 * 3 / 1000"})," = ",(0,r.jsx)(s.code,{children:"1.2"}),", which is rounded up to ",(0,r.jsx)(s.code,{children:"2chicken"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["An order is settling for ",(0,r.jsx)(s.code,{children:"3000chicken"}),": ",(0,r.jsx)(s.code,{children:"3000 * 3 / 1000"})," = ",(0,r.jsx)(s.code,{children:"9"}),", which doesn't need rounding, so stays at ",(0,r.jsx)(s.code,{children:"9chicken"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["The actual amount isn't known until settlement, but a minimum can be calculated by applying the applicable ratio to an ask order's ",(0,r.jsx)(s.code,{children:"price"}),".\nThe seller settlement ratio fee will be at least that amount, but since it gets larger slower than the price, ",(0,r.jsx)(s.code,{children:"<ask order price> - <ratio fee based on ask order price> - <flat fee>"})," is the least amount the seller will end up with."]}),"\n",(0,r.jsx)(s.h4,{id:"buyer-settlement-ratio-fee",children:"Buyer Settlement Ratio Fee"}),"\n",(0,r.jsxs)(s.p,{children:["A market's ",(0,r.jsx)(s.code,{children:"fee_buyer_settlement_ratios"})," can have ",(0,r.jsx)(s.code,{children:"FeeRatios"})," with any denom pair, i.e. the ",(0,r.jsx)(s.code,{children:"price"})," and ",(0,r.jsx)(s.code,{children:"fee"})," do not need to be the same denom.\nIt can also have multiple entries with the same ",(0,r.jsx)(s.code,{children:"price"})," denom or ",(0,r.jsx)(s.code,{children:"fee"})," denom, but it can only have one entry for each ",(0,r.jsx)(s.code,{children:"price"})," to ",(0,r.jsx)(s.code,{children:"fee"})," denom pair.\nE.g. a market can have ",(0,r.jsx)(s.code,{children:"100chicken:1cow"})," and also ",(0,r.jsx)(s.code,{children:"100chicken:7chicken"}),", ",(0,r.jsx)(s.code,{children:"500cow:1cow"}),", and ",(0,r.jsx)(s.code,{children:"5cow:1chicken"}),", but it couldn't also have ",(0,r.jsx)(s.code,{children:"105chicken:2cow"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["To calculate the buyer settlement ratio fee, the following formula is used: ",(0,r.jsx)(s.code,{children:"<bid price> * <ratio fee> / <ratio price>"}),".\nIf that is not a whole number, the chosen ratio is not applicable to the bid order's price and cannot be used.\nThe user will need to either use a different ratio or change their bid price."]}),"\n",(0,r.jsxs)(s.p,{children:["The buyer settlement ratio fee should be added to the buyer settlement flat fee and provided in the ",(0,r.jsx)(s.code,{children:"buyer_settlement_fees"})," in the bid order.\nThe ratio and flat fees can be in any denoms allowed by the market, and do not have to be the same."]}),"\n",(0,r.jsx)(s.h3,{id:"exchange-fees",children:"Exchange Fees"}),"\n",(0,r.jsxs)(s.p,{children:["A portion of the fees collected by a market, are given to the exchange.\nThe amount is defined using basis points in the exchange module's ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/params#params",children:"Params"})," and can be configured differently for specific denoms."]}),"\n",(0,r.jsx)(s.p,{children:"When the market collects fees, the applicable basis points are looked up and applied to the amount being collected.\nThat amount is then transferred from the market's account to the chain's fee collector (similar to gas fees)."}),"\n",(0,r.jsxs)(s.p,{children:["The following formula is used for each denom in the fees being collected: ",(0,r.jsx)(s.code,{children:"<fee amount> * <basis points> / 10,000"}),".\nIf that is not a whole number, it is rounded up to the next whole number."]}),"\n",(0,r.jsxs)(s.p,{children:["For example, Say the exchange has a default split of ",(0,r.jsx)(s.code,{children:"500"})," (basis points), and a specific split of ",(0,r.jsx)(s.code,{children:"100"})," for ",(0,r.jsx)(s.code,{children:"rooster"}),".\nWhen a market collects a fee of ",(0,r.jsx)(s.code,{children:"1500hen,710rooster"}),":\nThere is no specific split for ",(0,r.jsx)(s.code,{children:"hen"}),", so the default ",(0,r.jsx)(s.code,{children:"500"})," is used for them. ",(0,r.jsx)(s.code,{children:"1500 * 500 / 10,000"})," = ",(0,r.jsx)(s.code,{children:"75hen"})," (a whole number, so no rounding is needed).\nThe specific ",(0,r.jsx)(s.code,{children:"rooster"})," split of ",(0,r.jsx)(s.code,{children:"100"})," is used for those: ",(0,r.jsx)(s.code,{children:"710 * 100 / 10,000"})," = ",(0,r.jsx)(s.code,{children:"7.1"})," which gets rounded up to ",(0,r.jsx)(s.code,{children:"8rooster"}),".\nSo the market will first receive ",(0,r.jsx)(s.code,{children:"1500hen,710rooster"})," from the buyer(s)/seller(s), then ",(0,r.jsx)(s.code,{children:"75hen,8rooster"})," is transferred from the market to the fee collector.\nThe market is then left with ",(0,r.jsx)(s.code,{children:"1425hen:702rooster"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["During ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#marketsettle",children:"MarketSettle"}),", the math and rounding is applied to the total fee being collected (as opposed to applying it to each order's fee first, then summing that)."]}),"\n",(0,r.jsxs)(s.p,{children:["During order creation, the exchange's portion of the order creation fee is calculated and collected from the creation fee provided in the ",(0,r.jsx)(s.code,{children:"Msg"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["During ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#fillbids",children:"FillBids"})," or ",(0,r.jsx)(s.a,{href:"/docs/sdk/exchange/messages#fillasks",children:"FillAsks"}),", the settlement fees are summed and collected separately from the order creation fee.\nThat means the math and rounding is done twice, once for the total settlement fees and again for the order creation fee.\nThis is done so that the fees are collected the same as if an order were created and later settled by the market."]})]})}function h(e={}){const{wrapper:s}={...(0,n.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},11151:(e,s,t)=>{t.d(s,{Z:()=>d,a:()=>a});var r=t(67294);const n={},i=r.createContext(n);function a(e){const s=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);