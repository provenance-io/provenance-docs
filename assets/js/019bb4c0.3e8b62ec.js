"use strict";(self.webpackChunkprovenance_blockchain_developer_portal=self.webpackChunkprovenance_blockchain_developer_portal||[]).push([[6595],{95478:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>a,frontMatter:()=>c,metadata:()=>d,toc:()=>l});var r=i(85893),t=i(11151);const c={},o="Begin Blocker",d={id:"sdk/trigger/begin_and_end_blocker",title:"begin_and_end_blocker",description:"\x3c!--",source:"@site/docs/sdk/trigger/06_begin_and_end_blocker.md",sourceDirName:"sdk/trigger",slug:"/sdk/trigger/begin_and_end_blocker",permalink:"/docs/sdk/trigger/begin_and_end_blocker",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{},sidebar:"documentationSidebar",previous:{title:"events",permalink:"/docs/sdk/trigger/events"},next:{title:"genesis",permalink:"/docs/sdk/trigger/genesis"}},s={},l=[{value:"Trigger Execution",id:"trigger-execution",level:2},{value:"Note",id:"note",level:3},{value:"Block Event Detection",id:"block-event-detection",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#begin-blocker",children:"Begin Blocker"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#trigger-execution",children:"Trigger Execution"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#end-blocker",children:"End Blocker"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#block-event-detection",children:"Block Event Detection"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"begin-blocker",children:"Begin Blocker"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"BeginBlocker"})," abci call is invoked on the beginning of each block. ",(0,r.jsx)(n.code,{children:"Triggers"})," will be dequeued and ran."]}),"\n",(0,r.jsx)(n.h2,{id:"trigger-execution",children:"Trigger Execution"}),"\n",(0,r.jsxs)(n.p,{children:["The following steps are performed on each ",(0,r.jsx)(n.code,{children:"BeginBlocker"}),":\n2. A ",(0,r.jsx)(n.code,{children:"Trigger"})," is removed from the ",(0,r.jsx)(n.code,{children:"Queue"}),".\n3. The ",(0,r.jsx)(n.code,{children:"Gas Limit"})," for the ",(0,r.jsx)(n.code,{children:"Trigger"})," is retrieved from the store.\n4. A ",(0,r.jsx)(n.code,{children:"GasMeter"})," is created for the ",(0,r.jsx)(n.code,{children:"Trigger"}),".\n5. An ",(0,r.jsx)(n.code,{children:"Action"})," on the ",(0,r.jsx)(n.code,{children:"Trigger"})," is ran updating and verifying gas usage against the ",(0,r.jsx)(n.code,{children:"GasMeter"}),"\n6. The events for the ",(0,r.jsx)(n.code,{children:"Action"})," are emitted.\n7. Step 5 is repeated until no more ",(0,r.jsx)(n.code,{children:"Actions"})," exist for the trigger.\n8. Step 1 is repeated until the ",(0,r.jsx)(n.code,{children:"Queue"})," is empty or the ",(0,r.jsx)(n.code,{children:"throttling limit"})," has been reached."]}),"\n",(0,r.jsx)(n.h3,{id:"note",children:"Note"}),"\n",(0,r.jsxs)(n.p,{children:["We have implemented a ",(0,r.jsx)(n.code,{children:"throttling limit"})," within the module's ",(0,r.jsx)(n.code,{children:"BeginBlocker"}),", effectively enforcing a maximum of 5 actions and a gas limit of 2,000,000 per ",(0,r.jsx)(n.code,{children:"BeginBlock"}),"."]}),"\n",(0,r.jsx)(n.h1,{id:"end-blocker",children:"End Blocker"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"EndBlocker"})," abci call is ran at the end of each block. The ",(0,r.jsx)(n.code,{children:"EventManager"}),", ",(0,r.jsx)(n.code,{children:"BlockHeight"}),", and ",(0,r.jsx)(n.code,{children:"BlockTime"})," are monitored and used to detect ",(0,r.jsx)(n.code,{children:"Trigger"})," activation."]}),"\n",(0,r.jsx)(n.h2,{id:"block-event-detection",children:"Block Event Detection"}),"\n",(0,r.jsxs)(n.p,{children:["The following is logic is used to detect the activation of a ",(0,r.jsx)(n.code,{children:"Trigger"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"EventManager"})," is utilized to traverse the transaction events from the newly created block."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"Event Listener"})," table filters for ",(0,r.jsx)(n.code,{children:"Triggers"})," containing a ",(0,r.jsx)(n.code,{children:"TransactionEvent"})," matching the transaction event types and containing the defined ",(0,r.jsx)(n.code,{children:"Attributes"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"Event Listener"})," table filters for ",(0,r.jsx)(n.code,{children:"Triggers"})," containing a ",(0,r.jsx)(n.code,{children:"BlockHeightEvent"})," that is greater than or equal to the current ",(0,r.jsx)(n.code,{children:"BlockHeight"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"Event Listener"})," table filters for ",(0,r.jsx)(n.code,{children:"Triggers"})," containing a ",(0,r.jsx)(n.code,{children:"BlockTimeEvent"})," that is greater than or equal to the current ",(0,r.jsx)(n.code,{children:"BlockTime"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["These ",(0,r.jsx)(n.code,{children:"Triggers"})," are then unregistered and added to the ",(0,r.jsx)(n.code,{children:"Queue"}),"."]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>d,a:()=>o});var r=i(67294);const t={},c=r.createContext(t);function o(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);