"use strict";(self.webpackChunkprovenance_blockchain_developer_portal=self.webpackChunkprovenance_blockchain_developer_portal||[]).push([[3471],{57616:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>o,toc:()=>a});var r=i(85893),t=i(11151);const d={},c="Begin Blocker",o={id:"sdk/reward/begin_and_end_blocker",title:"begin_and_end_blocker",description:"\x3c!--",source:"@site/docs/sdk/reward/07_begin_and_end_blocker.md",sourceDirName:"sdk/reward",slug:"/sdk/reward/begin_and_end_blocker",permalink:"/docs/sdk/reward/begin_and_end_blocker",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{},sidebar:"documentationSidebar",previous:{title:"events",permalink:"/docs/sdk/reward/events"},next:{title:"genesis",permalink:"/docs/sdk/reward/genesis"}},l={},a=[{value:"State Machine Update",id:"state-machine-update",level:2},{value:"Qualifying Action Detection",id:"qualifying-action-detection",level:2}];function s(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"begin-blocker",children:"Begin Blocker"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"BeginBlocker"})," abci call is invoked on the beginning of each block. The newly created block's ",(0,r.jsx)(n.code,{children:"BlockTime"})," field is used to update the ",(0,r.jsx)(n.code,{children:"Reward Programs"})," and ",(0,r.jsx)(n.code,{children:"Reward Claims"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"state-machine-update",children:"State Machine Update"}),"\n",(0,r.jsxs)(n.p,{children:["The following conditional logic is evaluated to help a ",(0,r.jsx)(n.code,{children:"Reward Program"})," transition between states:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Starts a ",(0,r.jsx)(n.code,{children:"Reward Program"})," if the ",(0,r.jsx)(n.code,{children:"BlockTime"})," >= ",(0,r.jsx)(n.code,{children:"program_start_time"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Evaluates if ",(0,r.jsx)(n.code,{children:"BlockTime"})," >= ",(0,r.jsx)(n.code,{children:"claim_period_end_time"}),", and if it evaluates to true the ",(0,r.jsx)(n.code,{children:"Reward Program"})," will ",(0,r.jsx)(n.em,{children:"attempt"})," to progress to the next claim period."]}),"\n",(0,r.jsxs)(n.li,{children:["The Reward Program will successfully progress to the next claim period, if all of the following criteria are true:","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"remaining_pool_balance"})," >= ",(0,r.jsx)(n.code,{children:"minimum_rollover_amount"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"BlockTime"})," < ",(0,r.jsx)(n.code,{children:"program_end_time_max"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["If either of the previously mentioned criteria is not met, then the ",(0,r.jsx)(n.code,{children:"Reward Program"})," will end."]}),"\n",(0,r.jsxs)(n.li,{children:["A completed ",(0,r.jsx)(n.code,{children:"Reward Program"})," will then expire after ",(0,r.jsx)(n.code,{children:"reward_claim_expiration_offset"})," seconds from its completion time."]}),"\n",(0,r.jsxs)(n.li,{children:["All expired ",(0,r.jsx)(n.code,{children:"Reward Program"})," will return any unused funds to the reward creator and expire any unclaimed rewards."]}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"end-blocker",children:"End Blocker"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"EndBlocker"})," abci call is ran at the end of each block. The ",(0,r.jsx)(n.code,{children:"EventManager"})," is monitored and ",(0,r.jsx)(n.code,{children:"Qualifying Actions"})," are deduced from newly created events and prior internal state."]}),"\n",(0,r.jsx)(n.h2,{id:"qualifying-action-detection",children:"Qualifying Action Detection"}),"\n",(0,r.jsxs)(n.p,{children:["The following is logic is used to detect ",(0,r.jsx)(n.code,{children:"Qualifying Actions"})," and grant shares:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"EventManager"})," is utilized to traverse the events from the newly created block."]}),"\n",(0,r.jsxs)(n.li,{children:["Using the ",(0,r.jsx)(n.code,{children:"QualifyingAction"})," types defined in each active ",(0,r.jsx)(n.code,{children:"RewardProgram"}),", the module attempts to build actions using the event and any prior events."]}),"\n",(0,r.jsxs)(n.li,{children:["Each detected action will then be evaluated and only deemed a ",(0,r.jsx)(n.code,{children:"QualifyingAction"})," if it matches the ",(0,r.jsx)(n.code,{children:"Evaluation Criteria"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["One or more shares will be granted to the participant performing the ",(0,r.jsx)(n.code,{children:"QualifyingAction"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Participants can then claim these shares once the claim period that they were earned in completes."}),"\n",(0,r.jsx)(n.li,{children:"Detects qualifying events based on events in EventManager for reward programs currently running."}),"\n",(0,r.jsx)(n.li,{children:"Gives out shares for a running rewards program for that claim period for a given address performing qualifying events."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(s,{...e})}):s(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>o,a:()=>c});var r=i(67294);const t={},d=r.createContext(t);function c(e){const n=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);