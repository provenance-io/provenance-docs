"use strict";(self.webpackChunkprovenance_blockchain_developer_portal=self.webpackChunkprovenance_blockchain_developer_portal||[]).push([[9245],{23276:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var s=n(85893),r=n(11151);const i={},a="Exchange Concepts",d={id:"sdk/exchange/concepts",title:"Exchange Concepts",description:"The x/exchange module facilitates the trading of on-chain assets.",source:"@site/docs/sdk/exchange/01_concepts.md",sourceDirName:"sdk/exchange",slug:"/sdk/exchange/concepts",permalink:"/docs/sdk/exchange/concepts",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"documentationSidebar",previous:{title:"x/exchange",permalink:"/docs/sdk/exchange/"},next:{title:"Exchange State",permalink:"/docs/sdk/exchange/state"}},c={},l=[{value:"Markets",id:"markets",level:2},{value:"Required Attributes",id:"required-attributes",level:3},{value:"Market Permissions",id:"market-permissions",level:3},{value:"Settlement",id:"settlement",level:3},{value:"Commitment Settlement",id:"commitment-settlement",level:3},{value:"Transfer Agent",id:"transfer-agent",level:3},{value:"Orders",id:"orders",level:2},{value:"Ask Orders",id:"ask-orders",level:3},{value:"Bid Orders",id:"bid-orders",level:3},{value:"Partial Orders",id:"partial-orders",level:3},{value:"External IDs",id:"external-ids",level:3},{value:"Commitments",id:"commitments",level:2},{value:"Payments",id:"payments",level:2},{value:"Fees",id:"fees",level:2},{value:"Order Creation Fees",id:"order-creation-fees",level:3},{value:"Settlement Flat Fees",id:"settlement-flat-fees",level:3},{value:"Settlement Ratio Fees",id:"settlement-ratio-fees",level:3},{value:"Seller Settlement Ratio Fee",id:"seller-settlement-ratio-fee",level:4},{value:"Buyer Settlement Ratio Fee",id:"buyer-settlement-ratio-fee",level:4},{value:"Commitment Fees",id:"commitment-fees",level:3},{value:"Commitment Creation Fees",id:"commitment-creation-fees",level:4},{value:"Commitment Settlement Fee Collection",id:"commitment-settlement-fee-collection",level:4},{value:"Commitment Settlement Fee Charge",id:"commitment-settlement-fee-charge",level:4},{value:"Commitment Settlement Fee Charge Example",id:"commitment-settlement-fee-charge-example",level:5},{value:"Exchange Fees for Orders",id:"exchange-fees-for-orders",level:3},{value:"Exchange Fees for Commitments",id:"exchange-fees-for-commitments",level:3},{value:"Exchange Fees for Payments",id:"exchange-fees-for-payments",level:3}];function o(e){const t={a:"a",annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",hr:"hr",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",ol:"ol",p:"p",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"exchange-concepts",children:"Exchange Concepts"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"x/exchange"})," module facilitates the trading of on-chain assets."]}),"\n",(0,s.jsx)(t.p,{children:"Markets provide fee structures and are responsible for identifying and triggering settlements.\nOrders are created by users to indicate a desire to trade on-chain funds in a market.\nThe exchange module defines a portion of market fees to be paid to the chain (distributed like gas fees)."}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#markets",children:"Markets"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#required-attributes",children:"Required Attributes"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#market-permissions",children:"Market Permissions"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#settlement",children:"Settlement"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#commitment-settlement",children:"Commitment Settlement"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#transfer-agent",children:"Transfer Agent"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#orders",children:"Orders"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#ask-orders",children:"Ask Orders"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#bid-orders",children:"Bid Orders"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#partial-orders",children:"Partial Orders"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#external-ids",children:"External IDs"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#commitments",children:"Commitments"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#payments",children:"Payments"})}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#fees",children:"Fees"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#order-creation-fees",children:"Order Creation Fees"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#settlement-flat-fees",children:"Settlement Flat Fees"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#settlement-ratio-fees",children:"Settlement Ratio Fees"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#commitment-fees",children:"Commitment Fees"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#exchange-fees-for-orders",children:"Exchange Fees for Orders"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#exchange-fees-for-commitments",children:"Exchange Fees for Commitments"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#exchange-fees-for-payments",children:"Exchange Fees for Payments"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"markets",children:"Markets"}),"\n",(0,s.jsxs)(t.p,{children:["A market is a combination of on-chain setup and off-chain processes.\nThey are created by a governance proposal using the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#msggovcreatemarketrequest",children:"MsgGovCreateMarketRequest"})," message.\nMost aspects of the market are then manageable using permissioned endpoints.\nFees can only be managed with a governance proposal using the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#msggovmanagefeesrequest",children:"MsgGovManageFeesRequest"})," message."]}),"\n",(0,s.jsx)(t.p,{children:"Each market has a set of optional details designed for human-use, e.g. name, description, website url."}),"\n",(0,s.jsx)(t.p,{children:"If a market accepts orders, it is responsible (off-chain) for identifying order matches and triggering (on-chain) settlement.\nIf a market accepts commitments, it is able to manage committed funds and is responsible for releasing commitments as needed."}),"\n",(0,s.jsx)(t.p,{children:"A market receives fees for order creation and order settlement. It also defines what fees are required and what is acceptable as payments."}),"\n",(0,s.jsxs)(t.p,{children:["A market can delegate various ",(0,s.jsx)(t.a,{href:"#market-permissions",children:"permissions"})," to other accounts, allowing those accounts to use specific endpoints on behalf of the market."]}),"\n",(0,s.jsxs)(t.p,{children:["Markets can restrict who can create orders or commitments with them by defining account attributes that are required to create orders. See ",(0,s.jsx)(t.a,{href:"#required-attributes",children:"Required Attributes"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Markets can control whether user-settlement is allowed.\nWhen user-settlement is allowed, the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#fillbids",children:"FillBids"})," and ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#fillasks",children:"FillAsks"})," endpoints can be used for orders in the market."]}),"\n",(0,s.jsx)(t.p,{children:"A market can also control whether orders can be created for it.\nWhen order creation is not allowed, any existing orders can still be settled or cancelled, but no new ones can be made (in that market)."}),"\n",(0,s.jsx)(t.p,{children:"A market can separately control whether funds can be committed to it.\nWhen commitments are not allowed, any existing commitments can still be settled or cancelled, but no new funds can be committed (to that market)."}),"\n",(0,s.jsxs)(t.p,{children:["The fees collected by a market are kept in the market's account, and can be accessed using the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketwithdraw",children:"MarketWithdraw"})," endpoint."]}),"\n",(0,s.jsxs)(t.p,{children:["See also: ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#market",children:"Market"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"required-attributes",children:"Required Attributes"}),"\n",(0,s.jsx)(t.p,{children:"There is a separate list of attributes required to create each order type and commitments.\nIf one or more attributes are required for an action, the associated account (e.g. buyer, seller, or committer) must have all of them on their account."}),"\n",(0,s.jsxs)(t.p,{children:["Required attributes can have a wildcard at the start to indicate that any attribute with the designated base and one (or more) level(s) is applicable.\nThe only place a wildcard ",(0,s.jsx)(t.code,{children:"*"})," is allowed is at the start of the string and must be immediately followed by a period.\nFor example, a required attribute of ",(0,s.jsx)(t.code,{children:"*.kyc.pb"})," would match an account attribute of ",(0,s.jsx)(t.code,{children:"buyer.kyc.pb"})," or ",(0,s.jsx)(t.code,{children:"special.seller.kyc.pb"}),", but not ",(0,s.jsx)(t.code,{children:"buyer.xkyc.pb"})," (wrong base) or ",(0,s.jsx)(t.code,{children:"kyc.pb"})," (no extra level)."]}),"\n",(0,s.jsxs)(t.p,{children:["Attributes are defined using the ",(0,s.jsx)(t.a,{href:"/x/name/spec/README.md",children:"x/name"})," module, and are managed on accounts using the ",(0,s.jsx)(t.a,{href:"/x/attribute/spec/README.md",children:"x/attributes"})," module."]}),"\n",(0,s.jsx)(t.h3,{id:"market-permissions",children:"Market Permissions"}),"\n",(0,s.jsxs)(t.p,{children:["The different available permissions are defined by the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#permission",children:"Permission"})," proto enum message."]}),"\n",(0,s.jsxs)(t.p,{children:["Each market manages its own set of ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#accessgrant",children:"AccessGrants"}),", which confer specific permissions to specific addresses."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"PERMISSION_UNSPECIFIED"}),": it is an error to try to use this permission for anything."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"PERMISSION_SETTLE"}),": accounts with this permission can use the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketsettle",children:"MarketSettle"})," endpoint for a market."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"PERMISSION_SET_IDS"}),": accounts with this permission can use the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketsetorderexternalid",children:"MarketSetOrderExternalID"})," endpoint for a market."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"PERMISSION_CANCEL"}),": accounts with this permission can use the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#cancelorder",children:"CancelOrder"})," and ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketreleasecommitments",children:"MarketReleaseCommitments"})," endpoints to cancel orders and release commitments in a market."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"PERMISSION_WITHDRAW"}),": accounts with this permission can use the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketwithdraw",children:"MarketWithdraw"})," endpoint for a market."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"PERMISSION_UPDATE"}),": accounts with this permission can use the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketupdatedetails",children:"MarketUpdateDetails"}),", ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketupdateacceptingorders",children:"MarketUpdateAcceptingOrders"}),", ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketupdateusersettle",children:"MarketUpdateUserSettle"}),", ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketupdateacceptingcommitments",children:"MarketUpdateAcceptingCommitments"}),", and ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketupdateintermediarydenom",children:"MarketUpdateIntermediaryDenom"})," endpoints for a market."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"PERMISSION_PERMISSIONS"}),": accounts with this permission can use the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketmanagepermissions",children:"MarketManagePermissions"})," endpoint for a market."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"PERMISSION_ATTRIBUTES"}),": accounts with this permission can use the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketmanagereqattrs",children:"MarketManageReqAttrs"})," endpoint for a market."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"settlement",children:"Settlement"}),"\n",(0,s.jsxs)(t.p,{children:["Each market is responsible for the settlement of its orders.\nTo do this, it must first identify a matching set of asks and bids.\nThe ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketsettle",children:"MarketSettle"})," endpoint is then used to settle and clear orders.\nIf the market allows, users can also settlement orders with their own funds using the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#fillbids",children:"FillBids"})," or ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#fillasks",children:"FillAsks"})," endpoints."]}),"\n",(0,s.jsxs)(t.p,{children:["During settlement, at most one order can be partially filled, and it must be the last order in its list (in ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#msgmarketsettlerequest",children:"MsgMarketSettleRequest"}),").\nThat order must allow partial settlement (defined at order creation) and be evenly divisible (see ",(0,s.jsx)(t.a,{href:"#partial-orders",children:"Partial Orders"}),").\nThe market must also set the ",(0,s.jsx)(t.code,{children:"expect_partial"})," field to ",(0,s.jsx)(t.code,{children:"true"})," in the request.\nIf all of the orders are being filled in full, the ",(0,s.jsx)(t.code,{children:"expect_partial"})," field must be ",(0,s.jsx)(t.code,{children:"false"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["All orders in a settlement must have the same ",(0,s.jsx)(t.code,{children:"assets"})," denoms, and also the same ",(0,s.jsx)(t.code,{children:"price"})," denoms, but the fees can be anything.\nThe total bid price must be at least the total ask price (accounting for partial fulfillment if applicable)."]}),"\n",(0,s.jsx)(t.p,{children:"During settlement:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["The ",(0,s.jsx)(t.code,{children:"assets"})," are transferred directly from the seller(s) to the buyer(s)."]}),"\n",(0,s.jsxs)(t.li,{children:["The ",(0,s.jsx)(t.code,{children:"price"})," funds are transferred directly from the buyer(s) to the seller(s)."]}),"\n",(0,s.jsx)(t.li,{children:"All settlement fees are transferred directly from the seller(s) and buyer(s) to the market."}),"\n",(0,s.jsx)(t.li,{children:"The exchange's portion of the fees is transferred from the market to the chain's fee collector."}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["With complex settlements, it's possible that an ask order's ",(0,s.jsx)(t.code,{children:"assets"})," go to a different account than the ",(0,s.jsx)(t.code,{children:"price"})," funds come from, and vice versa for bid orders."]}),"\n",(0,s.jsxs)(t.p,{children:["Transfers of the ",(0,s.jsx)(t.code,{children:"assets"})," and ",(0,s.jsx)(t.code,{children:"price"})," bypass the quarantine module since order creation can be viewed as acceptance of those funds.\nNo other send-restrictions are bypassed (e.g. ",(0,s.jsx)(t.code,{children:"x/marker"})," or ",(0,s.jsx)(t.code,{children:"x/sanction"})," module restrictions).\nE.g. If an order's funds are in a sanctioned account, settlement of that order will fail since those funds cannot be removed from that account."]}),"\n",(0,s.jsx)(t.h3,{id:"commitment-settlement",children:"Commitment Settlement"}),"\n",(0,s.jsxs)(t.p,{children:["A market can move funds committed to it by using the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketcommitmentsettle",children:"MarketCommitmentSettle"})," endpoint."]}),"\n",(0,s.jsx)(t.p,{children:"During commitment settlement:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Holds are released on the funds to be transferred."}),"\n",(0,s.jsx)(t.li,{children:"The funds are transferred."}),"\n",(0,s.jsx)(t.li,{children:"The funds are re-committed in the destination accounts."}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["The market can collect fees as part of this settlement, but is also charged extra fees for the tx.\nSee also: ",(0,s.jsx)(t.a,{href:"#commitment-fees",children:"Commitment Fees"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["The funds are re-committed regardless of the market's ",(0,s.jsx)(t.code,{children:"accepting_commitments"})," value.\nThe accounts these funds are being re-committed to also are not required to have the create-commitment required attributes."]}),"\n",(0,s.jsx)(t.h3,{id:"transfer-agent",children:"Transfer Agent"}),"\n",(0,s.jsxs)(t.p,{children:["During a settlement, commitment settlement, or market withdrawal, the ",(0,s.jsx)(t.code,{children:"admin"})," is also used as the transfer agent.\nA transfer agent is used by the ",(0,s.jsx)(t.code,{children:"x/marker"})," module's ",(0,s.jsx)(t.a,{href:"../../marker/spec/12_transfers.md#send-restrictions",children:"Send Restrictions"})," to help facilitate movement of restricted coins.\nE.g. an ",(0,s.jsx)(t.code,{children:"admin"})," with ",(0,s.jsx)(t.code,{children:"transfer"})," access for a denom and ",(0,s.jsx)(t.code,{children:"settle"})," permission for a market can use a settlement to transfer restricted funds to a recipient, regardless of required attributes on that denom or the attributes of the recipient.\nIf an ",(0,s.jsx)(t.code,{children:"admin"})," does ",(0,s.jsx)(t.strong,{children:"not"})," have ",(0,s.jsx)(t.code,{children:"transfer"})," access for a restricted denom, settlements can still succeed if the recipient has the required attributes for that denom."]}),"\n",(0,s.jsx)(t.h2,{id:"orders",children:"Orders"}),"\n",(0,s.jsx)(t.p,{children:"Orders are created by users that want to trade assets in a market."}),"\n",(0,s.jsx)(t.p,{children:"When an order is created, a hold is placed on the applicable funds.\nThose funds will remain in the user's account until the order is settled or cancelled.\nThe holds ensure that the required funds are available at settlement without the need of an intermediary holding/clearing account.\nDuring settlement, the funds get transferred directly between the buyers and sellers, and fees are paid from the buyers and sellers directly to the market."}),"\n",(0,s.jsx)(t.p,{children:"Orders can be cancelled by either the user or the market."}),"\n",(0,s.jsx)(t.p,{children:"Once an order is created, it cannot be modified except in these specific ways:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"When an order is partially filled, the amounts in it will be reduced accordingly."}),"\n",(0,s.jsx)(t.li,{children:"An order's external id can be changed by the market."}),"\n",(0,s.jsx)(t.li,{children:"Cancelling an order will release the held funds and delete the order."}),"\n",(0,s.jsx)(t.li,{children:"Settling an order in full will delete the order."}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"ask-orders",children:"Ask Orders"}),"\n",(0,s.jsxs)(t.p,{children:["Ask orders represent a desire to sell some specific ",(0,s.jsx)(t.code,{children:"assets"})," at a minimum ",(0,s.jsx)(t.code,{children:"price"}),".\nWhen an ask order is created, a hold is placed on the ",(0,s.jsx)(t.code,{children:"assets"})," being sold.\nIf the denom of the ",(0,s.jsx)(t.code,{children:"seller_settlement_flat_fee"})," is different from the denom of the price, a hold is placed on that flat fee too.\nIt's possible for an ask order to be filled at a larger ",(0,s.jsx)(t.code,{children:"price"})," than initially defined."]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"seller_settlement_flat_fee"})," is verified at the time of order creation, but only paid during settlement."]}),"\n",(0,s.jsxs)(t.p,{children:["When an ask order is settled, the ",(0,s.jsx)(t.code,{children:"assets"})," are transferred directly to the buyer(s) and the ",(0,s.jsx)(t.code,{children:"price"})," is transferred directly from the buyer(s).\nThen the seller settlement fees are transferred from the seller to the market."]}),"\n",(0,s.jsxs)(t.p,{children:["During settlement, the seller settlement fee ratio with the appropriate ",(0,s.jsx)(t.code,{children:"price"})," denom is applied to the price the seller is receiving.\nThat result is then added to the ask order's ",(0,s.jsx)(t.code,{children:"seller_settlement_flat_fee"})," to get the total settlement fee to be paid for the ask order.\nIn this way, the seller's settlement ratio fee can be taken out of the ",(0,s.jsx)(t.code,{children:"price"})," funds that the seller is receiving.\nIf the ",(0,s.jsx)(t.code,{children:"seller_settlement_flat_fee"})," is the same denom as the price, it can come out of the ",(0,s.jsx)(t.code,{children:"price"})," funds too."]}),"\n",(0,s.jsxs)(t.p,{children:["Because the fees can come out of the ",(0,s.jsx)(t.code,{children:"price"})," funds, it's possible (probable) that the total ",(0,s.jsx)(t.code,{children:"price"})," funds that the seller ends up with, is less than their requested price."]}),"\n",(0,s.jsxs)(t.p,{children:["For example, a user creates an ask order to sell ",(0,s.jsx)(t.code,{children:"2cow"})," (the ",(0,s.jsx)(t.code,{children:"assets"}),") and wants at least ",(0,s.jsx)(t.code,{children:"15chicken"})," (the ",(0,s.jsx)(t.code,{children:"price"}),").\nThe market finds a way to settle that order where the seller will get ",(0,s.jsx)(t.code,{children:"16chicken"}),", but the seller's settlement fee will end up being ",(0,s.jsx)(t.code,{children:"2chicken"}),".\nDuring settlement, the ",(0,s.jsx)(t.code,{children:"2cow"})," are transferred from the seller to the buyer, and ",(0,s.jsx)(t.code,{children:"16chicken"})," are transferred from the buyer to the seller.\nThen, ",(0,s.jsx)(t.code,{children:"2chicken"})," are transferred from the seller to the market.\nSo the seller ends up with ",(0,s.jsx)(t.code,{children:"14chicken"})," for their ",(0,s.jsx)(t.code,{children:"2cow"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["See also: ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#askorder",children:"AskOrder"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"bid-orders",children:"Bid Orders"}),"\n",(0,s.jsxs)(t.p,{children:["Bid orders represent a desire to buy some specific ",(0,s.jsx)(t.code,{children:"assets"})," at a specific ",(0,s.jsx)(t.code,{children:"price"}),".\nWhen a bid order is created, a hold is placed on the order's ",(0,s.jsx)(t.code,{children:"price"})," and ",(0,s.jsx)(t.code,{children:"buyer_settlement_fees"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["When a bid order is settled, the ",(0,s.jsx)(t.code,{children:"price"})," is transferred directly to the seller(s) and the assets are transferred directly from the seller(s).\nThen, the buyer settlement fees are transferred from the buyer to the market."]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"buyer_settlement_fees"})," are verified at the time of order creation, but only paid during settlement.\nThey are paid in addition to the ",(0,s.jsx)(t.code,{children:"price"})," the buyer is paying."]}),"\n",(0,s.jsxs)(t.p,{children:["See also: ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#bidorder",children:"BidOrder"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"partial-orders",children:"Partial Orders"}),"\n",(0,s.jsxs)(t.p,{children:["Both Ask orders and Bid orders can optionally allow partial fulfillment by setting the ",(0,s.jsx)(t.code,{children:"allow_partial"})," field to ",(0,s.jsx)(t.code,{children:"true"})," when creating the order."]}),"\n",(0,s.jsxs)(t.p,{children:["When an order is partially filled, the order's same ",(0,s.jsx)(t.code,{children:"assets:price"})," and ",(0,s.jsx)(t.code,{children:"assets:settlement-fees"})," ratios are maintained."]}),"\n",(0,s.jsx)(t.p,{children:"Since only whole numbers are allowed, this means that:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"<order price> * <assets filled> / <order assets>"})," must be a whole number."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"<settlement fees> * <assets filled> / <order assets>"})," must also be a whole number."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["When an ask order is partially filled, it's ",(0,s.jsx)(t.code,{children:"price"})," and ",(0,s.jsx)(t.code,{children:"seller_settlement_flat_fee"})," are reduced at the same rate as the assets, even if the seller is receiving a higher price than requested.\nE.g. If an ask order selling ",(0,s.jsx)(t.code,{children:"2cow"})," for ",(0,s.jsx)(t.code,{children:"10chicken"})," is partially settled for ",(0,s.jsx)(t.code,{children:"1cow"})," at a price of ",(0,s.jsx)(t.code,{children:"6chicken"}),", the seller will receive the ",(0,s.jsx)(t.code,{children:"6chicken"})," but the updated ask order will list that there's still ",(0,s.jsx)(t.code,{children:"1cow"})," for sale for ",(0,s.jsx)(t.code,{children:"5chicken"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"When an order is partially filled, its amounts are updated to reflect what hasn't yet been filled."}),"\n",(0,s.jsx)(t.p,{children:"An order that allows partial fulfillment can be partially filled multiple times (as long as the numbers allow for it)."}),"\n",(0,s.jsxs)(t.p,{children:["Settlement will fail if an order is being partially filled that either doesn't allow it, or cannot be evenly split at the needed ",(0,s.jsx)(t.code,{children:"assets"})," amount."]}),"\n",(0,s.jsx)(t.h3,{id:"external-ids",children:"External IDs"}),"\n",(0,s.jsxs)(t.p,{children:["Orders can be identified using an off-chain identifier.\nThese can be provided during order creation (in the ",(0,s.jsx)(t.code,{children:"external_id"})," field).\nThey can also be set by the market after the order has been created using the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketsetorderexternalid",children:"MarketSetOrderExternalID"})," endpoint."]}),"\n",(0,s.jsxs)(t.p,{children:["Each external id is unique inside a market.\nI.e. two orders in the same market cannot have the same external id, but two orders in different markets ",(0,s.jsx)(t.strong,{children:"can"})," have the same external id.\nAn attempt (by a user) to create an order with a duplicate external id, will fail.\nAn attempt (by a market) to change an order's external id to one already in use, will fail."]}),"\n",(0,s.jsxs)(t.p,{children:["The external ids are optional, so it's possible that multiple orders in a market have an empty string for the external id.\nOrders with external ids can be looked up using the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/queries#getorderbyexternalid",children:"GetOrderByExternalID"})," query (as well as the other order queries)."]}),"\n",(0,s.jsx)(t.p,{children:"External ids are limited to 100 characters."}),"\n",(0,s.jsx)(t.h2,{id:"commitments",children:"Commitments"}),"\n",(0,s.jsx)(t.p,{children:"A Commitment allows an account to give control of some of its funds to a market."}),"\n",(0,s.jsxs)(t.p,{children:["When funds are committed to a market, they remain in the source account and a ",(0,s.jsx)(t.a,{href:"../../hold/spec/01_concepts.md#holds",children:"hold"})," is placed on them.\nCommitted funds are not usable by the account they are in; only the market can move them.\nThe funds stay in the account until the market either moves them using the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketcommitmentsettle",children:"MarketCommitmentSettle"})," endpoint or cancels the commitment in part or full.\nCommitments can only be cancelled by the market (or a governance proposal)."]}),"\n",(0,s.jsx)(t.p,{children:"For a market to start accepting commitments, it must have either a settlement bips, or a commitment creation flat fee defined.\nIf a settlement bips is defined, an intermediary denom must also be defined and a NAV must exist from the intermediary denom to the chain's fee denom."}),"\n",(0,s.jsxs)(t.p,{children:["Management of the settlement bips and commitment creation fee options is part of the fee-management governance proposal.\nThe ",(0,s.jsx)(t.code,{children:"accepting_commitments"})," flag and intermediary denom are managed using the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketupdateacceptingcommitments",children:"MarketUpdateAcceptingCommitments"})," and ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketupdateintermediarydenom",children:"MarketUpdateIntermediaryDenom"})," endpoints."]}),"\n",(0,s.jsx)(t.h2,{id:"payments",children:"Payments"}),"\n",(0,s.jsx)(t.p,{children:"A payment is used to trade fund between two accounts."}),"\n",(0,s.jsxs)(t.p,{children:["The account that creates the payment is the ",(0,s.jsx)(t.code,{children:"source"}),".\nThe account that can accept (or reject) the payment is the ",(0,s.jsx)(t.code,{children:"target"}),".\nA target does not need to be declared when a payment is created.\nA payment's target can be changed (by the source) until it has been accepted, rejected, or cancelled."]}),"\n",(0,s.jsxs)(t.p,{children:["The amount that the ",(0,s.jsx)(t.code,{children:"source"})," is providing is the ",(0,s.jsx)(t.code,{children:"source_amount"}),".\nThe amount that the ",(0,s.jsx)(t.code,{children:"target"})," is providing is the ",(0,s.jsx)(t.code,{children:"target_amount"}),".\nBoth the ",(0,s.jsx)(t.code,{children:"source_amount"})," and ",(0,s.jsx)(t.code,{children:"target_amount"})," are optional, but at least one must be provided."]}),"\n",(0,s.jsxs)(t.p,{children:["When a payment is created, a hold is placed the ",(0,s.jsx)(t.code,{children:"source_amount"})," funds (in the ",(0,s.jsx)(t.code,{children:"source"})," account).\nWhen a payment is accepted, that hold is released.\nThen the ",(0,s.jsx)(t.code,{children:"source_amount"})," is sent from the ",(0,s.jsx)(t.code,{children:"source"})," to the ",(0,s.jsx)(t.code,{children:"target"}),", and the ",(0,s.jsx)(t.code,{children:"target_amount"})," is sent from the ",(0,s.jsx)(t.code,{children:"target"})," to the ",(0,s.jsx)(t.code,{children:"source"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["A payment is uniquely identified by its ",(0,s.jsx)(t.code,{children:"source"})," and ",(0,s.jsx)(t.code,{children:"external_id"}),".\nIt is up to the ",(0,s.jsx)(t.code,{children:"source"})," to choose an ",(0,s.jsx)(t.code,{children:"external_id"})," that they are not already using in another payment.\nOnce a payment has been accepted, rejected, or cancelled, its external id can be reused by the source.\nTwo different sources can use the same external id."]}),"\n",(0,s.jsxs)(t.p,{children:["In order to accept a payment, all the details of the payment must be provided in the request.\nThis ensures that the ",(0,s.jsx)(t.code,{children:"target"})," accepts the terms of the payment."]}),"\n",(0,s.jsxs)(t.p,{children:["Creating or accepting a payment may require an extra amount to be included in the tx fees.\nThis amount is defined in the exchange module ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/params",children:"Params"}),".\nThe amount required for a specific payment can be calculated using the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/queries#paymentfeecalc",children:"PaymentFeeCalc"})," query."]}),"\n",(0,s.jsx)(t.h2,{id:"fees",children:"Fees"}),"\n",(0,s.jsx)(t.p,{children:"Markets dictate the minimum required fees. It's possible to pay more than the required fees, but not less."}),"\n",(0,s.jsxs)(t.p,{children:["A portion of the fees that a market collects are sent to the blockchain and distributed similar to gas fees.\nThis portion is dictated by the exchange module in its ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/params",children:"params"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"There are several types of fees:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Order creation: Flat fees paid at the time that an order is created."}),"\n",(0,s.jsx)(t.li,{children:"Settlement flat fees: A fee paid during settlement that is the same for each order."}),"\n",(0,s.jsx)(t.li,{children:"Settlement ratio fees: A fee paid during settlement that is based off of the order's price."}),"\n",(0,s.jsx)(t.li,{children:"Commitment fees: Fees paid in relation to commitments."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"For each fee type, there is a configuration for each order type.\nE.g. the ask-order creation fee is configured separately from the bid-order creation fee."}),"\n",(0,s.jsxs)(t.p,{children:["Each fee type is only paid in a single denom, but a market can define multiple options for each.\nE.g. if flat fee options for a specific fee are ",(0,s.jsx)(t.code,{children:"5chicken,1cow"}),", users can provide ",(0,s.jsx)(t.strong,{children:"either"})," ",(0,s.jsx)(t.code,{children:"5chicken"})," or ",(0,s.jsx)(t.code,{children:"1cow"})," to fulfill that required fee."]}),"\n",(0,s.jsxs)(t.p,{children:["If a market does not have any options defined for a given fee type, that fee is not required.\nE.g. if the ",(0,s.jsx)(t.code,{children:"fee_create_ask_flat"})," field is empty, there is no fee required to create an ask order."]}),"\n",(0,s.jsx)(t.p,{children:"All fees except the seller settlement ratio fees must be provided with order creation, and are validated at order creation."}),"\n",(0,s.jsx)(t.h3,{id:"order-creation-fees",children:"Order Creation Fees"}),"\n",(0,s.jsxs)(t.p,{children:["This is a fee provided in the ",(0,s.jsx)(t.code,{children:"order_creation_fee"})," field of the order creation ",(0,s.jsx)(t.code,{children:"Msg"}),"s and is collected immediately.\nThese are paid on top of any gas or message fees required."]}),"\n",(0,s.jsx)(t.p,{children:"Each order type has its own creation fee configuration:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"fee_create_ask_flat"}),": The available ",(0,s.jsx)(t.code,{children:"Coin"})," fee options for creating an ask order."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"fee_create_bid_flat"}),": The available ",(0,s.jsx)(t.code,{children:"Coin"})," fee options for creating a bid order."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"settlement-flat-fees",children:"Settlement Flat Fees"}),"\n",(0,s.jsx)(t.p,{children:"This is a fee provided as part of an order, but is not collected until settlement."}),"\n",(0,s.jsx)(t.p,{children:"Each order type has its own settlement flat fee configuration:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"fee_seller_settlement_flat"}),": The available ",(0,s.jsx)(t.code,{children:"Coin"})," fee options that are paid by the seller during settlement."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"fee_buyer_settlement_flat"}),": The available ",(0,s.jsx)(t.code,{children:"Coin"})," fee options that are paid by the buyer during settlement."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["The ask order's ",(0,s.jsx)(t.code,{children:"seller_settlement_flat_fee"})," must be at least one of the available ",(0,s.jsx)(t.code,{children:"fee_seller_settlement_flat"})," options.\nThe bid order's ",(0,s.jsx)(t.code,{children:"buyer_settlement_fees"})," must be enough to cover one of the ",(0,s.jsx)(t.code,{children:"fee_buyer_settlement_flat"})," options plus one of the buyer settlement ratio fee options."]}),"\n",(0,s.jsx)(t.h3,{id:"settlement-ratio-fees",children:"Settlement Ratio Fees"}),"\n",(0,s.jsxs)(t.p,{children:["A ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#feeratio",children:"FeeRatio"})," is a pair of ",(0,s.jsx)(t.code,{children:"Coin"}),"s defining a ",(0,s.jsx)(t.code,{children:"price"})," to ",(0,s.jsx)(t.code,{children:"fee"})," ratio."]}),"\n",(0,s.jsx)(t.p,{children:"Each order type has its own settlement ratio fee configurations:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"fee_seller_settlement_ratios"}),": The available ",(0,s.jsx)(t.code,{children:"FeeRatio"})," options that are applied to the ",(0,s.jsx)(t.code,{children:"price"})," received."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"fee_buyer_settlement_ratios"}),": The available ",(0,s.jsx)(t.code,{children:"FeeRatio"})," options that are applied to the bid order's ",(0,s.jsx)(t.code,{children:"price"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["If a market defines both buyer and seller settlement ratios, they should define ratios in each with the same set of ",(0,s.jsx)(t.code,{children:"price"})," denoms.\nE.g. if there's a ",(0,s.jsx)(t.code,{children:"fee_buyer_settlement_ratios"})," entry of ",(0,s.jsx)(t.code,{children:"100chicken:1cow"}),", there should be an entry in ",(0,s.jsx)(t.code,{children:"fee_seller_settlement_ratios"})," with a price denom of ",(0,s.jsx)(t.code,{children:"chicken"})," (or ",(0,s.jsx)(t.code,{children:"fee_seller_settlement_ratios"})," should be empty)."]}),"\n",(0,s.jsxs)(t.p,{children:["If a market requires both, but there's a price denom in the ",(0,s.jsx)(t.code,{children:"fee_buyer_settlement_ratios"})," that isn't in ",(0,s.jsx)(t.code,{children:"fee_seller_settlement_ratios"}),", then orders with that denom in their ",(0,s.jsx)(t.code,{children:"price"})," cannot be settled.\nIf a market requires both, but there's a price denom in the ",(0,s.jsx)(t.code,{children:"fee_seller_settlement_ratios"})," that isn't in ",(0,s.jsx)(t.code,{children:"fee_buyer_settlement_ratios"}),", then bid orders with that denom in their ",(0,s.jsx)(t.code,{children:"price"})," cannot be created, so ask orders with that price denom will have nothing to settle with."]}),"\n",(0,s.jsxs)(t.p,{children:["A ",(0,s.jsx)(t.code,{children:"FeeRatio"})," can have a zero ",(0,s.jsx)(t.code,{children:"fee"})," amount (but not a zero ",(0,s.jsx)(t.code,{children:"price"})," amount), e.g. ",(0,s.jsx)(t.code,{children:"1chicken:0chicken"})," is okay, but ",(0,s.jsx)(t.code,{children:"0chicken:1chicken"})," is bad.\nThis allows a market to not charge a ratio fee for a specific ",(0,s.jsx)(t.code,{children:"price"})," denom."]}),"\n",(0,s.jsxs)(t.p,{children:["A ",(0,s.jsx)(t.code,{children:"FeeRatio"})," with the same ",(0,s.jsx)(t.code,{children:"price"})," and ",(0,s.jsx)(t.code,{children:"fee"})," denoms must have a larger price amount than fee amount."]}),"\n",(0,s.jsx)(t.h4,{id:"seller-settlement-ratio-fee",children:"Seller Settlement Ratio Fee"}),"\n",(0,s.jsxs)(t.p,{children:["A market's ",(0,s.jsx)(t.code,{children:"fee_seller_settlement_ratios"})," are limited to ",(0,s.jsx)(t.code,{children:"FeeRatio"}),"s that have the same ",(0,s.jsx)(t.code,{children:"price"})," and ",(0,s.jsx)(t.code,{children:"fee"})," denom.\nThis ensures that the seller settlement fee can always be paid by the funds the seller is receiving."]}),"\n",(0,s.jsxs)(t.p,{children:["To calculate the seller settlement ratio fee, the following formula is used: ",(0,s.jsx)(t.code,{children:"<settlement price> * <ratio fee> / <ratio price>"}),".\nIf that is not a whole number, it is rounded up to the next whole number."]}),"\n",(0,s.jsxs)(t.p,{children:["E.g. A market has ",(0,s.jsx)(t.code,{children:"1000chicken:3chicken"})," in ",(0,s.jsx)(t.code,{children:"fee_seller_settlement_ratios"}),"."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["An order is settling for ",(0,s.jsx)(t.code,{children:"400chicken"}),": ",(0,s.jsx)(t.code,{children:"400 * 3 / 1000"})," = ",(0,s.jsx)(t.code,{children:"1.2"}),", which is rounded up to ",(0,s.jsx)(t.code,{children:"2chicken"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["An order is settling for ",(0,s.jsx)(t.code,{children:"3000chicken"}),": ",(0,s.jsx)(t.code,{children:"3000 * 3 / 1000"})," = ",(0,s.jsx)(t.code,{children:"9"}),", which doesn't need rounding, so stays at ",(0,s.jsx)(t.code,{children:"9chicken"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["The actual amount isn't known until settlement, but a minimum can be calculated by applying the applicable ratio to an ask order's ",(0,s.jsx)(t.code,{children:"price"}),".\nThe seller settlement ratio fee will be at least that amount, but since it gets larger slower than the price, ",(0,s.jsx)(t.code,{children:"<ask order price> - <ratio fee based on ask order price> - <flat fee>"})," is the least amount the seller will end up with."]}),"\n",(0,s.jsx)(t.h4,{id:"buyer-settlement-ratio-fee",children:"Buyer Settlement Ratio Fee"}),"\n",(0,s.jsxs)(t.p,{children:["A market's ",(0,s.jsx)(t.code,{children:"fee_buyer_settlement_ratios"})," can have ",(0,s.jsx)(t.code,{children:"FeeRatios"})," with any denom pair, i.e. the ",(0,s.jsx)(t.code,{children:"price"})," and ",(0,s.jsx)(t.code,{children:"fee"})," do not need to be the same denom.\nIt can also have multiple entries with the same ",(0,s.jsx)(t.code,{children:"price"})," denom or ",(0,s.jsx)(t.code,{children:"fee"})," denom, but it can only have one entry for each ",(0,s.jsx)(t.code,{children:"price"})," to ",(0,s.jsx)(t.code,{children:"fee"})," denom pair.\nE.g. a market can have ",(0,s.jsx)(t.code,{children:"100chicken:1cow"})," and also ",(0,s.jsx)(t.code,{children:"100chicken:7chicken"}),", ",(0,s.jsx)(t.code,{children:"500cow:1cow"}),", and ",(0,s.jsx)(t.code,{children:"5cow:1chicken"}),", but it couldn't also have ",(0,s.jsx)(t.code,{children:"105chicken:2cow"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["To calculate the buyer settlement ratio fee, the following formula is used: ",(0,s.jsx)(t.code,{children:"<bid price> * <ratio fee> / <ratio price>"}),".\nIf that is not a whole number, it is rounded up to the next whole number."]}),"\n",(0,s.jsxs)(t.p,{children:["The buyer settlement ratio fee should be added to the buyer settlement flat fee and provided in the ",(0,s.jsx)(t.code,{children:"buyer_settlement_fees"})," in the bid order.\nThe ratio and flat fees can be in any denoms allowed by the market, and do not have to be the same."]}),"\n",(0,s.jsx)(t.h3,{id:"commitment-fees",children:"Commitment Fees"}),"\n",(0,s.jsx)(t.p,{children:"A market can collect commitment fees at commitment creation and/or during settlement."}),"\n",(0,s.jsx)(t.p,{children:"A market is also charged an extra Tx fee when doing a settlement."}),"\n",(0,s.jsx)(t.h4,{id:"commitment-creation-fees",children:"Commitment Creation Fees"}),"\n",(0,s.jsxs)(t.p,{children:["Similar to order creation fees, these are paid by the committer at the time of committal.\nA portion of these fees are given to the exchange.\nThis can only be defined as a flat fee: ",(0,s.jsx)(t.code,{children:"fee_create_commitment_flat"}),": The available ",(0,s.jsx)(t.code,{children:"Coin"})," fee options that are paid by the committer when committing funds.\nThe commitment's ",(0,s.jsx)(t.code,{children:"creation_fee"})," must be at least one of the available ",(0,s.jsx)(t.code,{children:"fee_create_commitment_flat"})," options."]}),"\n",(0,s.jsx)(t.h4,{id:"commitment-settlement-fee-collection",children:"Commitment Settlement Fee Collection"}),"\n",(0,s.jsxs)(t.p,{children:["During a commitment settlement, a market can collect fees by populating the ",(0,s.jsx)(t.code,{children:"fees"})," field in the ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#msgmarketcommitmentsettlerequest",children:"MsgMarketCommitmentSettleRequest"}),".\nThe exchange does ",(0,s.jsx)(t.strong,{children:"NOT"})," keep any portion of these fees.\nOnly fees that have been committed to the market can be collected in this way."]}),"\n",(0,s.jsx)(t.h4,{id:"commitment-settlement-fee-charge",children:"Commitment Settlement Fee Charge"}),"\n",(0,s.jsxs)(t.p,{children:["An additional fee is charged (similar to a msg-based fee) for commitment settlements that is based on the total funds being moved.\nThe ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/queries#commitmentsettlementfeecalc",children:"CommitmentSettlementFeeCalc"})," query can be used to find out how much the fee will be for a commitment settlement.\nThis fee is provided as a portion of the tx fees (in addition to any gas or other fees)."]}),"\n",(0,s.jsx)(t.p,{children:"The fee is calculated as such:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Sum the settlement inputs."}),"\n",(0,s.jsx)(t.li,{children:"Use Marker Net-Asset-Value (NAV) entries (or provided NAV entries) to convert the total into the market's intermediary denom (any amounts in the fee denom are not converted)."}),"\n",(0,s.jsx)(t.li,{children:"A NAV is used to convert the intermediary total to the fee denom (which is added to any fee denom amount in the inputs)."}),"\n",(0,s.jsxs)(t.li,{children:["The market's ",(0,s.jsx)(t.code,{children:"commitment_settlement_bips"})," is applied to the fee denom total."]}),"\n",(0,s.jsx)(t.li,{children:"That total is divided by two to get the final fee amount."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"During step 2, the amount of the intermediary denom is tracked as a real number (not limited to integers).\nAt the end of that step, the sum is rounded up to the next integer."}),"\n",(0,s.jsxs)(t.p,{children:["Technically both steps 4 and 5 are done together by doing ",(0,s.jsx)(t.code,{children:"amount * bips / 20,000"}),". If that is not an integer, the result is rounded up."]}),"\n",(0,s.jsxs)(t.p,{children:["If a NAV is needed for fee calculation, but does not exist (or wasn't provided), commitment settlement will fail.\nTo help, NAVs can be provided as part of a commitment settlement and the marker module will be updated with any NAV info provided.\nNAVs are ",(0,s.jsx)(t.strong,{children:"NOT"})," updated in the query, only when provided as part of a settlement.\nNAVs provided to the query are still used for that query, though."]}),"\n",(0,s.jsxs)(t.p,{children:['The total is divided by two because the sum of the inputs is effectively double what we usually think of as the "value of a trade".\nE.g. If buying  ',(0,s.jsx)(t.code,{children:"1candybar"})," for ",(0,s.jsx)(t.code,{children:"99cusd"}),", we think of the value of that trade as ",(0,s.jsxs)(t.span,{className:"katex",children:[(0,s.jsx)(t.span,{className:"katex-mathml",children:(0,s.jsx)(t.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,s.jsxs)(t.semantics,{children:[(0,s.jsxs)(t.mrow,{children:[(0,s.jsx)(t.mn,{children:"0.99."}),(0,s.jsx)(t.mi,{children:"W"}),(0,s.jsx)(t.mi,{children:"i"}),(0,s.jsx)(t.mi,{children:"t"}),(0,s.jsx)(t.mi,{children:"h"}),(0,s.jsx)(t.mi,{children:"o"}),(0,s.jsx)(t.mi,{children:"u"}),(0,s.jsx)(t.mi,{children:"t"}),(0,s.jsx)(t.mi,{children:"t"}),(0,s.jsx)(t.mi,{children:"h"}),(0,s.jsx)(t.mi,{children:"e"}),(0,s.jsx)(t.mi,{children:"h"}),(0,s.jsx)(t.mi,{children:"a"}),(0,s.jsx)(t.mi,{children:"l"}),(0,s.jsx)(t.mi,{children:"v"}),(0,s.jsx)(t.mi,{children:"i"}),(0,s.jsx)(t.mi,{children:"n"}),(0,s.jsx)(t.mi,{children:"g"}),(0,s.jsx)(t.mo,{separator:"true",children:","}),(0,s.jsx)(t.mi,{children:"t"}),(0,s.jsx)(t.mi,{children:"h"}),(0,s.jsx)(t.mi,{children:"o"}),(0,s.jsx)(t.mi,{children:"u"}),(0,s.jsx)(t.mi,{children:"g"}),(0,s.jsx)(t.mi,{children:"h"}),(0,s.jsx)(t.mo,{separator:"true",children:","}),(0,s.jsx)(t.mi,{children:"w"}),(0,s.jsx)(t.mi,{children:"e"}),(0,s.jsx)(t.mi,{children:"m"}),(0,s.jsx)(t.mi,{children:"i"}),(0,s.jsx)(t.mi,{children:"g"}),(0,s.jsx)(t.mi,{children:"h"}),(0,s.jsx)(t.mi,{children:"t"}),(0,s.jsx)(t.mi,{children:"h"}),(0,s.jsx)(t.mi,{children:"a"}),(0,s.jsx)(t.mi,{children:"v"}),(0,s.jsx)(t.mi,{children:"e"}),(0,s.jsx)(t.mi,{children:"e"}),(0,s.jsx)(t.mi,{children:"n"}),(0,s.jsx)(t.mi,{children:"d"}),(0,s.jsx)(t.mi,{children:"e"}),(0,s.jsx)(t.mi,{children:"d"}),(0,s.jsx)(t.mi,{children:"u"}),(0,s.jsx)(t.mi,{children:"p"}),(0,s.jsx)(t.mi,{children:"w"}),(0,s.jsx)(t.mi,{children:"i"}),(0,s.jsx)(t.mi,{children:"t"}),(0,s.jsx)(t.mi,{children:"h"}),(0,s.jsx)(t.mi,{children:"a"}),(0,s.jsx)(t.mi,{children:"t"}),(0,s.jsx)(t.mi,{children:"o"}),(0,s.jsx)(t.mi,{children:"t"}),(0,s.jsx)(t.mi,{children:"a"}),(0,s.jsx)(t.mi,{children:"l"}),(0,s.jsx)(t.mi,{children:"o"}),(0,s.jsx)(t.mi,{children:"f"})]}),(0,s.jsx)(t.annotation,{encoding:"application/x-tex",children:"0.99.\nWithout the halving, though, we might have ended up with a total of "})]})})}),(0,s.jsx)(t.span,{className:"katex-html","aria-hidden":"true",children:(0,s.jsxs)(t.span,{className:"base",children:[(0,s.jsx)(t.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,s.jsx)(t.span,{className:"mord",children:"0.99."}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"Wi"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"t"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"h"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"o"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"u"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"tt"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"h"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"e"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"ha"}),(0,s.jsx)(t.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,s.jsx)(t.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"in"}),(0,s.jsx)(t.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,s.jsx)(t.span,{className:"mpunct",children:","}),(0,s.jsx)(t.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"t"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"h"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"o"}),(0,s.jsx)(t.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"ug"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"h"}),(0,s.jsx)(t.span,{className:"mpunct",children:","}),(0,s.jsx)(t.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,s.jsx)(t.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"e"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"mi"}),(0,s.jsx)(t.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"h"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"t"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"ha"}),(0,s.jsx)(t.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"ee"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"n"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"d"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"e"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"d"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"u"}),(0,s.jsx)(t.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"pw"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"i"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"t"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"ha"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"t"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"o"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"t"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"a"}),(0,s.jsx)(t.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,s.jsx)(t.span,{className:"mord mathnormal",children:"o"}),(0,s.jsx)(t.span,{className:"mord mathnormal",style:{marginRight:"0.10764em"},children:"f"})]})})]}),"1.98 by converting the ",(0,s.jsx)(t.code,{children:"1candybar"})," into ",(0,s.jsx)(t.code,{children:"cusd"})," (hopefully ",(0,s.jsx)(t.code,{children:"99cusd"}),") and adding that to the other ",(0,s.jsx)(t.code,{children:"99cusd"}),"."]}),"\n",(0,s.jsx)(t.h5,{id:"commitment-settlement-fee-charge-example",children:"Commitment Settlement Fee Charge Example"}),"\n",(0,s.jsx)(t.p,{children:"A commitment settlement is requested with the following data and market setup:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"name"}),(0,s.jsx)(t.th,{children:"value"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Input Total"}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"30apple,93banana,87cherry,300nhash"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"NAVs"}),(0,s.jsxs)(t.td,{children:[(0,s.jsx)(t.code,{children:"21apple:500cherry"}),", ",(0,s.jsx)(t.code,{children:"44banana:77cherry"}),", ",(0,s.jsx)(t.code,{children:"10cherry:31nhash"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Intermediary Denom"}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"cherry"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Bips"}),(0,s.jsx)(t.td,{children:"25"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Fee Denom"}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"nhash"})})]})]})]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Convert the input total to the intermediary denom:","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"30apple"})," * ",(0,s.jsx)(t.code,{children:"500cherry"}),"/",(0,s.jsx)(t.code,{children:"21apple"})," = ",(0,s.jsx)(t.code,{children:"714.285714285714cherry"})]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"93banana"})," * ",(0,s.jsx)(t.code,{children:"77cherry"}),"/",(0,s.jsx)(t.code,{children:"44banana"})," = ",(0,s.jsx)(t.code,{children:"162.75cherry"})]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"87cherry"})," => ",(0,s.jsx)(t.code,{children:"87cherry"})," (already intermediary denom, do not convert yet)"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"300nhash"})," => ",(0,s.jsx)(t.code,{children:"300nhash"})," (already in fee denom, do not convert)"]}),"\n",(0,s.jsxs)(t.li,{children:["Sum: ",(0,s.jsx)(t.code,{children:"964.035714285714cherry"})," => ",(0,s.jsx)(t.code,{children:"965cherry"})," (and ",(0,s.jsx)(t.code,{children:"300nhash"}),")."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["Convert that to the fee denom:","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"965cherry"})," * ",(0,s.jsx)(t.code,{children:"31nhash"}),"/",(0,s.jsx)(t.code,{children:"10cherry"})," = ",(0,s.jsx)(t.code,{children:"2991.5nhash"})," => ",(0,s.jsx)(t.code,{children:"2992nhash"})]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"300nhash"})," => ",(0,s.jsx)(t.code,{children:"300nhash"})," (already in fee denom, do not convert)"]}),"\n",(0,s.jsxs)(t.li,{children:["Sum: ",(0,s.jsx)(t.code,{children:"3292nhash"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["Apply Bips:","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"3292nhash"})," * ",(0,s.jsx)(t.code,{children:"25"}),"/",(0,s.jsx)(t.code,{children:"20000"})," = ",(0,s.jsx)(t.code,{children:"4.115nhash"})," => ",(0,s.jsx)(t.code,{children:"5nhash"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["The market will need to provide an extra ",(0,s.jsx)(t.code,{children:"5nhash"})," with the ",(0,s.jsx)(t.code,{children:"Tx"})," fees in order to do this commitment settlement."]}),"\n",(0,s.jsx)(t.h3,{id:"exchange-fees-for-orders",children:"Exchange Fees for Orders"}),"\n",(0,s.jsxs)(t.p,{children:["A portion of the fees collected by a market for order creation and settlement, are given to the exchange.\nThe amount is defined using basis points in the exchange module's ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/params#params",children:"Params"})," and can be configured differently for specific denoms."]}),"\n",(0,s.jsx)(t.p,{children:"When the market collects fees, the applicable basis points are looked up and applied to the amount being collected.\nThat amount is then transferred from the market's account to the chain's fee collector (similar to gas fees)."}),"\n",(0,s.jsxs)(t.p,{children:["The following formula is used for each denom in the fees being collected: ",(0,s.jsx)(t.code,{children:"<fee amount> * <basis points> / 10,000"}),".\nIf that is not a whole number, it is rounded up to the next whole number."]}),"\n",(0,s.jsxs)(t.p,{children:["For example, Say the exchange has a default split of ",(0,s.jsx)(t.code,{children:"500"})," (basis points), and a specific split of ",(0,s.jsx)(t.code,{children:"100"})," for ",(0,s.jsx)(t.code,{children:"rooster"}),".\nWhen a market collects a fee of ",(0,s.jsx)(t.code,{children:"1500hen,710rooster"}),":\nThere is no specific split for ",(0,s.jsx)(t.code,{children:"hen"}),", so the default ",(0,s.jsx)(t.code,{children:"500"})," is used for them. ",(0,s.jsx)(t.code,{children:"1500 * 500 / 10,000"})," = ",(0,s.jsx)(t.code,{children:"75hen"})," (a whole number, so no rounding is needed).\nThe specific ",(0,s.jsx)(t.code,{children:"rooster"})," split of ",(0,s.jsx)(t.code,{children:"100"})," is used for those: ",(0,s.jsx)(t.code,{children:"710 * 100 / 10,000"})," = ",(0,s.jsx)(t.code,{children:"7.1"})," which gets rounded up to ",(0,s.jsx)(t.code,{children:"8rooster"}),".\nSo the market will first receive ",(0,s.jsx)(t.code,{children:"1500hen,710rooster"})," from the buyer(s)/seller(s), then ",(0,s.jsx)(t.code,{children:"75hen,8rooster"})," is transferred from the market to the fee collector.\nThe market is then left with ",(0,s.jsx)(t.code,{children:"1425hen:702rooster"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["During ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#marketsettle",children:"MarketSettle"}),", the math and rounding is applied to the total fee being collected (as opposed to applying it to each order's fee first, then summing that)."]}),"\n",(0,s.jsxs)(t.p,{children:["During order creation, the exchange's portion of the order creation fee is calculated and collected from the creation fee provided in the ",(0,s.jsx)(t.code,{children:"Msg"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["During ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#fillbids",children:"FillBids"})," or ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/messages#fillasks",children:"FillAsks"}),", the settlement fees are summed and collected separately from the order creation fee.\nThat means the math and rounding is done twice, once for the total settlement fees and again for the order creation fee.\nThis is done so that the fees are collected the same as if an order were created and later settled by the market."]}),"\n",(0,s.jsx)(t.h3,{id:"exchange-fees-for-commitments",children:"Exchange Fees for Commitments"}),"\n",(0,s.jsx)(t.p,{children:"When a commitment is created, a portion of the fee collected by the market is given to the exchange in the same manner that order creation fees are handled."}),"\n",(0,s.jsxs)(t.p,{children:["During a commitment settlement, the exchange collects a fee proportional to the funds being settled.\nThis fee must be included in the ",(0,s.jsx)(t.code,{children:"Tx"})," fees provided with a ",(0,s.jsx)(t.code,{children:"MsgMarketCommitmentSettleRequest"}),".\nSee ",(0,s.jsx)(t.a,{href:"#commitment-settlement-fee-charge",children:"Commitment Settlement Fee Charge"})," for details."]}),"\n",(0,s.jsx)(t.h3,{id:"exchange-fees-for-payments",children:"Exchange Fees for Payments"}),"\n",(0,s.jsxs)(t.p,{children:["When a payment is created with a non-zero ",(0,s.jsx)(t.code,{children:"source_amount"}),", an extra amount is required to be included in the tx fees.\nWhen a payment is accepted with a non-zero ",(0,s.jsx)(t.code,{children:"target_amount"}),", an extra amount is required to be included in the tx fees."]}),"\n",(0,s.jsxs)(t.p,{children:["The amounts are flat and defined in the exchange module ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/params",children:"Params"})," with separate entries for creating and accepting payments.\nThe ",(0,s.jsx)(t.a,{href:"/docs/sdk/exchange/queries#paymentfeecalc",children:"PaymentFeeCalc"})," query can be used to identify the extra required tx fee amounts."]})]})}function h(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},11151:(e,t,n)=>{n.d(t,{Z:()=>d,a:()=>a});var s=n(67294);const r={},i=s.createContext(r);function a(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);