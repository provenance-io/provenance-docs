"use strict";(self.webpackChunkprovenance_blockchain_developer_portal=self.webpackChunkprovenance_blockchain_developer_portal||[]).push([[3298],{82403:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>c});var a=n(74848),i=n(28453);const t={},d="Concepts",o={id:"sdk/msgfees/concepts",title:"concepts",description:"\x3c!--",source:"@site/docs/sdk/msgfees/01_concepts.md",sourceDirName:"sdk/msgfees",slug:"/sdk/msgfees/concepts",permalink:"/docs/sdk/msgfees/concepts",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"documentationSidebar",previous:{title:"x/msgfees",permalink:"/docs/sdk/msgfees/"},next:{title:"state",permalink:"/docs/sdk/msgfees/state"}},l={},c=[{value:"Additional Msg Fees",id:"additional-msg-fees",level:2},{value:"Adding Custom Additional Fee from Wasm Contract",id:"adding-custom-additional-fee-from-wasm-contract",level:2},{value:"Base Fee",id:"base-fee",level:2},{value:"Total Fees",id:"total-fees",level:2},{value:"Additional Fee Assessed in Base Denom i.e nhash",id:"additional-fee-assessed-in-base-denom-ie-nhash",level:2},{value:"Authz and Wamsd Messages",id:"authz-and-wamsd-messages",level:2},{value:"Simulation and Calculating the Additional Fee to be Paid",id:"simulation-and-calculating-the-additional-fee-to-be-paid",level:2}];function r(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"concepts",children:"Concepts"})}),"\n",(0,a.jsx)(s.p,{children:"The msg fees modules manages additional fees that can be applied to tx msgs specified through governance."}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#additional-msg-fees",children:"Additional Msg Fees"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#adding-custom-additional-fee-from-wasm-contract",children:"Adding Custom Additional Fee from Wasm Contract"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#base-fee",children:"Base Fee"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#total-fees",children:"Total Fees"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#additional-fee-assessed-in-base-denom-ie-nhash",children:"Additional Fee Assessed in Base Denom i.e nhash"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#authz-and-wamsd-messages",children:"Authz and Wamsd Messages"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#simulation-and-calculating-the-additional-fee-to-be-paid",children:"Simulation and Calculating the Additional Fee to be Paid"})}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"additional-msg-fees",children:"Additional Msg Fees"}),"\n",(0,a.jsx)(s.p,{children:"Fees is one of the most important tools available to secure a PoS network since it incentives staking and encourages spam prevention etc."}),"\n",(0,a.jsxs)(s.p,{children:["As part of the provenance blockchain economics certain messages ",(0,a.jsx)(s.em,{children:"may"})," require an additional fee to be paid in\naddition to the normal gas consumption."]}),"\n",(0,a.jsxs)(s.p,{children:["Additional fees are assessed and finally consumed based on msgType of the msgs contained in the transaction,\nand the fee schedule that is persisted on chain.  These additional fees are created/updated/removed by governance through ",(0,a.jsx)(s.code,{children:"AddMsgFeeProposal"}),", ",(0,a.jsx)(s.code,{children:"UpdateMsgFeeProposal"}),", and ",(0,a.jsx)(s.code,{children:"RemoveMsgFeeProposal"})," proposals."]}),"\n",(0,a.jsxs)(s.p,{children:["Additional fee can be in any ",(0,a.jsx)(s.em,{children:"denom"}),".  This can be split to an optional bech32 account address with basis points."]}),"\n",(0,a.jsx)(s.h2,{id:"adding-custom-additional-fee-from-wasm-contract",children:"Adding Custom Additional Fee from Wasm Contract"}),"\n",(0,a.jsxs)(s.p,{children:["Creators of wasm contracts have the ability to dispatch an ",(0,a.jsx)(s.code,{children:"MsgAssessCustomMsgFeeRequest"})," that charges a custom fee\ndefined by the creator of the contract.  The set fee will be split between the fee module and a specified address in the\nmsg.  ",(0,a.jsx)(s.a,{href:"/docs/sdk/msgfees/messages",children:"Assess Fee Specifications"})]}),"\n",(0,a.jsx)(s.h2,{id:"base-fee",children:"Base Fee"}),"\n",(0,a.jsx)(s.p,{children:"Base fee is the current fee implementation. Fees are paid in base denom and determined by gas value passed into the Tx.\nThe value collected remains the same."}),"\n",(0,a.jsx)(s.h2,{id:"total-fees",children:"Total Fees"}),"\n",(0,a.jsxs)(s.p,{children:["Total fees = Additional Fees (if any) + Base Fee\nTotal fees continue to be passed as ",(0,a.jsx)(s.code,{children:"sdk.Coins"})," the Tx accepts for fee entry currently.\ne.g usd.example is the denom(assuming there is a marker/coin of type usd.example) in which additional fee is being charged in"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"--fees 382199010nhash,99usd.example \n"})}),"\n",(0,a.jsx)(s.h2,{id:"additional-fee-assessed-in-base-denom-ie-nhash",children:"Additional Fee Assessed in Base Denom i.e nhash"}),"\n",(0,a.jsxs)(s.p,{children:["To preserve backwards compatibility of all invokes, clients continue accepting fees in sdk.Coins ",(0,a.jsx)(s.code,{children:"type Coins []Coin"}),", and because the code needs to distinguish between base fee and additional fee, the msgfees module introduces an additional param, described in ",(0,a.jsx)(s.a,{href:"/docs/sdk/msgfees/params",children:"params documentation"}),", called ",(0,a.jsx)(s.code,{children:"DefaultFloorGasPrice"})," to differentiate between base fee and additional fee when additional fee is in same denom as default base denom i.e nhash."]}),"\n",(0,a.jsx)(s.p,{children:"This fee is charged initially by the antehandler, if any excess fee is left, once additional fee are paid, that's collected\nat the end of the Tx also(same as current behavior)"}),"\n",(0,a.jsx)(s.p,{children:"For e.g\nAdditional fee = 10000nhash\nGas = 10000\nFee passed in = 19070000nhash"}),"\n",(0,a.jsx)(s.p,{children:"In this client passes in an extra 10000nhash (1905 * 10000 +10000 = 19060000nhash).\nCurrent behavior is maintained and tx passes and charges 19050000 initially and 1000 nhash plus 1000nhash extra fee passed in the deliverTx stage.\nThus, this will protect against future changes like priority mempool as well as keep current behavior same as current production."}),"\n",(0,a.jsx)(s.h2,{id:"authz-and-wamsd-messages",children:"Authz and Wamsd Messages"}),"\n",(0,a.jsx)(s.p,{children:"Authz and wasmd messages are dispatched via the submessages route, so they get charged and assessed the same additional\nfee if set on a submessage, caveat being they forfeit all their fees if they fail (since we have no way upfront of knowing what\nthe submessages maybe)"}),"\n",(0,a.jsxs)(s.p,{children:["For Example, let's say a ",(0,a.jsx)(s.code,{children:"MsgSend"})," has a fee of 100usd.local and a smart contract does 3 MsgSend operations as per the logic of the smart contract, the code will expect additional fees of 300 usd.local (3 msgs x 100usd.local) to be present for the Tx to be successful."]}),"\n",(0,a.jsx)(s.h2,{id:"simulation-and-calculating-the-additional-fee-to-be-paid",children:"Simulation and Calculating the Additional Fee to be Paid"}),"\n",(0,a.jsx)(s.p,{children:"Current simulation method looks like this:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-kotlin",children:"val cosmosService = cosmos.tx.v1beta1.ServiceGrpc.newBlockingStub(channel)\ncosmosService.simulate(SimulateRequest.newBuilder().setTx(txFinal).build()).gasInfo.gasUsed\n            \n"})}),"\n",(0,a.jsx)(s.p,{children:"In the future we recommend using the method:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-kotlin",children:"val msgFeeClient = io.provenance.msgfees.v1.QueryGrpc.newBlockingStub(channel)\nmsgFeeClient.calculateTxFees(CalculateTxFeesRequest.newBuilder().setTx(txFinal).build())\n\n"})}),"\n",(0,a.jsx)(s.p,{children:"or from the cmd line as:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"provenanced tx simulate <required params>\n"})})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(r,{...e})}):r(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>o});var a=n(96540);const i={},t=a.createContext(i);function d(e){const s=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),a.createElement(t.Provider,{value:s},e.children)}}}]);