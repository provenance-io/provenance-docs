"use strict";(self.webpackChunkprovenance_blockchain_developer_portal=self.webpackChunkprovenance_blockchain_developer_portal||[]).push([[3798],{96170:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>l});var i=s(74848),o=s(28453);const t={description:"Submitting transactions to the blockchain."},c="Transaction Lifecycle",r={id:"pb/blockchain/basics/transaction-lifecycle",title:"Transaction Lifecycle",description:"Submitting transactions to the blockchain.",source:"@site/docs/pb/blockchain/basics/transaction-lifecycle.md",sourceDirName:"pb/blockchain/basics",slug:"/pb/blockchain/basics/transaction-lifecycle",permalink:"/docs/pb/blockchain/basics/transaction-lifecycle",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{description:"Submitting transactions to the blockchain."},sidebar:"documentationSidebar",previous:{title:"Anatomy of the Provenance Blockchain Application",permalink:"/docs/pb/blockchain/basics/anatomy-of-a-provenance-application"},next:{title:"Query Lifecycle",permalink:"/docs/pb/blockchain/basics/query-lifecycle"}},a={},l=[{value:"Transaction Flow",id:"transaction-flow",level:2},{value:"Transaction Endpoints",id:"transaction-endpoints",level:3},{value:"CLI",id:"cli",level:4},{value:"gRPC",id:"grpc",level:4},{value:"REST",id:"rest",level:4}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"transaction-lifecycle",children:"Transaction Lifecycle"})}),"\n",(0,i.jsx)(n.h2,{id:"transaction-flow",children:"Transaction Flow"}),"\n",(0,i.jsxs)(n.p,{children:["When users want to interact with the blockchain and make state changes (e.g. sending coins), they create transactions. ",(0,i.jsx)(n.a,{href:"https://docs.cosmos.network/main/core/transactions.html",children:"Transactions"})," originate via some user application and trigger state changes within a blockchain module (i.e. the bank module and transferring coin). Each of a transaction's ",(0,i.jsx)(n.code,{children:"Msg"}),"s must be signed using the private key associated with the appropriate ",(0,i.jsx)(n.a,{href:"/docs/pb/blockchain/basics/accounts",children:"account"}),"(s) before the transaction is broadcast to the network. A transaction must then be included in a block, validated, and approved by the network through the consensus process."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Transaction Submission Flow",src:s(33223).A+"",width:"2552",height:"1644"})}),"\n",(0,i.jsx)(n.p,{children:"The Transaction Submission Flow diagram illustrates how a user application transaction (e.g. transferring coins) flows within the blockchain:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["User input is captured by a User Application. The ",(0,i.jsx)(n.strong,{children:"User Application"})," is responsible for:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Building the appropriate blockchain ",(0,i.jsx)(n.code,{children:"Tx Msg"})," transaction message "]}),"\n",(0,i.jsxs)(n.li,{children:["Signing the ",(0,i.jsx)(n.code,{children:"Tx Msg"})," using a key pair from a wallet or Key Management facility"]}),"\n",(0,i.jsx)(n.li,{children:"Setting gas and fee parameters"}),"\n",(0,i.jsxs)(n.li,{children:["Submitting the signed ",(0,i.jsx)(n.code,{children:"Tx Msg"})," to a blockchain node using the CLI or ",(0,i.jsx)(n.code,{children:"gRPC."})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"Tx Msg"})," is received by a blockchain node, again a device running the ",(0,i.jsx)(n.code,{children:"provenanced"})," daemon process. The ",(0,i.jsx)(n.code,{children:"Tx Msg"})," is placed into the ",(0,i.jsx)(n.code,{children:"Mempool Cache"})," for ",(0,i.jsx)(n.a,{href:"https://docs.cosmos.network/main/basics/tx-lifecycle.html#addition-to-mempool",children:"pre-processing validation"}),". These pre-process checks include checking that the appropriate addresses are not empty, enforcing field checks like non-negative numbers, or other logic specified in the module.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If the ",(0,i.jsx)(n.code,{children:"Tx Msg"})," is invalid it is rejected and handled by the User Application. Nothing is added to the blockchain."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Once the ",(0,i.jsx)(n.code,{children:"Tx Msg"})," passes pre-processing in ",(0,i.jsx)(n.code,{children:"Check Tx"})," it is submitted to the ",(0,i.jsx)(n.code,{children:"Mempool"})," where is is broadcast to other blockchain peers and eligible for inclusion in a block. The ",(0,i.jsx)(n.code,{children:"Mempool"})," serves the purpose of keeping track of transactions seen by all full-nodes. Full-nodes keep the ",(0,i.jsx)(n.code,{children:"Mempool Cache"})," of the last transactions they have seen, as a first line of defense to prevent replay attacks. ",(0,i.jsx)(n.code,{children:"CheckTx"})," is responsible for identifying and rejecting replayed transactions."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.strong,{children:"Consensus Engine"})," uses a Consensus Round Structure where a ",(0,i.jsx)(n.strong,{children:"Proposer Node"})," is selected in turn. Thus, each round a new Proposer Node is designated to propose the new block. The Proposer Node selects transactions from its Mempool for inclusion in the proposed block. Note that each Node has an up-to-date copy of the Mempool communicated via node gossip.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Effectively, at each height of the blockchain a round-based protocol is run to determine the next block. Each round is composed of three ",(0,i.jsx)(n.em,{children:"steps"})," (",(0,i.jsx)(n.code,{children:"Propose"}),", ",(0,i.jsx)(n.code,{children:"Prevote"}),", and ",(0,i.jsx)(n.code,{children:"Precommit"}),"), along with two special steps ",(0,i.jsx)(n.code,{children:"Commit"})," and ",(0,i.jsx)(n.code,{children:"NewHeight"}),". Refer to ",(0,i.jsx)(n.a,{href:"https://docs.tendermint.com/master/spec/consensus/consensus.html",children:"the Tendermint Byzantine Consensus Algorithm"})," for more information."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Once the ",(0,i.jsx)(n.strong,{children:"Proposer Node"})," selects the ",(0,i.jsx)(n.code,{children:"Tx Msg"})," from the ",(0,i.jsx)(n.code,{children:"Mempool"})," it proposes a new block and broadcasts the proposed block."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"Tx Msg"})," is in the ",(0,i.jsx)(n.strong,{children:"Prevote"})," phase and each node broadcasts a prevote and listens for prevotes from other nodes.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If the block is invalid or a timeout is reached before a prevote is complete a Prevote Nil is broadcast. Otherwise, Pre-vote Block is broadcast."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["In the ",(0,i.jsx)(n.strong,{children:"Precommit"})," round, each node broadcasts its resulting Prevote response and listens for response from other nodes.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If > 2/3 nodes do not pre-vote for the same block and a timeout is reached Precommit Nil is broadcast. Otherwise, if > 2/3 nodes Prevote for the block a Pre-commit Block is broadcast."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["In the ",(0,i.jsx)(n.strong,{children:"Commit"})," phase the block is added and ",(0,i.jsx)(n.strong,{children:"New Height"})," is established (i.e. the blockchain block height increments)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If > 2/3 nodes to not pre-commit for the block or a timeout is reached, a No Commit is broadcast and the block is not added. Otherwise, if > 2/3 node pre-commit the block is committed."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Finally, the blockchain nodes dispatch Tx Events that can be handled by the User Application (i.e. block committed)."}),"\n",(0,i.jsx)(n.li,{children:"A New Round starts for the next transaction proposals."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The important components of this flow are:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Transactions are built and signed by a User Application before being submitted to a blockchain node. ",(0,i.jsxs)(n.em,{children:["The ",(0,i.jsx)(n.code,{children:"provenanced"})," binary can be considered a User Application when run via the command-line as a client."]})]}),"\n",(0,i.jsx)(n.li,{children:"The key pair and associated address used to sign and submit the transaction must hold Hash to pay the gas fees when submitting the transaction to the blockchain."}),"\n",(0,i.jsx)(n.li,{children:"The Transaction moves through multiple stages on the blockchain before it is committed in a block. Each of these stages can fail and must be handled by the User Application."}),"\n",(0,i.jsx)(n.li,{children:"The blockchain will broadcast events related to transaction processing that can be consumed by the User Application."}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"https://docs.cosmos.network/main/basics/tx-lifecycle.html",children:"Cosmos documentation also provides a Transaction Lifecycle walk through "}),"with detailed information about the Mempool, State Changes, Consensus Rounds, and more.  "]})}),"\n",(0,i.jsx)(n.h3,{id:"transaction-endpoints",children:"Transaction Endpoints"}),"\n",(0,i.jsx)(n.p,{children:"There are multiple interfaces to submit transactions to the blockchain."}),"\n",(0,i.jsx)(n.h4,{id:"cli",children:"CLI"}),"\n",(0,i.jsx)(n.p,{children:"The main interface for an application is the command-line interface. Users connect to a full-node and run the CLI directly from their machines - the CLI interacts directly with the full-node.  "}),"\n",(0,i.jsx)(n.h4,{id:"grpc",children:"gRPC"}),"\n",(0,i.jsxs)(n.p,{children:["Users and applications can submit transactions using ",(0,i.jsx)(n.a,{href:"https://grpc.io/",children:"gRPC"})," requests to a ",(0,i.jsx)(n.a,{href:"https://docs.cosmos.network/main/core/grpc_rest.html#grpc-server",children:"gRPC server"}),". The ",(0,i.jsx)(n.code,{children:"provenanced"})," daemon process is bundled with gRPC endpoints by default. The endpoints are defined as ",(0,i.jsx)(n.a,{href:"https://developers.google.com/protocol-buffers",children:"Protocol Buffers "}),"service methods inside ",(0,i.jsx)(n.code,{children:".proto"})," files, written in Protobuf's own language-agnostic interface definition language (IDL). The Protobuf ecosystem developed tools for code-generation from ",(0,i.jsx)(n.code,{children:"*.proto"})," files into various languages. These tools allow to build gRPC clients easily."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://github.com/fullstorydev/grpcurl",children:"gRPCurl"})," is an excellent command-line tool that can be used to interact with blockchain gRPC endpoints."]}),"\n",(0,i.jsx)(n.h4,{id:"rest",children:"REST"}),"\n",(0,i.jsxs)(n.p,{children:["Users and applications can submit transactions through HTTP Requests to a ",(0,i.jsx)(n.a,{href:"https://docs.cosmos.network/main/core/grpc_rest.html#rest-server",children:"REST server"}),". The REST server is fully auto-generated from Protobuf services, using ",(0,i.jsx)(n.a,{href:"https://github.com/grpc-ecosystem/grpc-gateway",children:"gRPC-gateway"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"../using-provenance/",children:"Refer to Using Provenanced"})," for hands-on transaction submission."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},33223:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/tx-submission-flow-9c43a92ef69b5533ed5e4b386ed3de51.png"},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>r});var i=s(96540);const o={},t=i.createContext(o);function c(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);