"use strict";(self.webpackChunkprovenance_docs=self.webpackChunkprovenance_docs||[]).push([[3675],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var d=a.createContext({}),s=function(e){var t=a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(d.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,d=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=s(n),h=r,m=p["".concat(d,".").concat(h)]||p[h]||u[h]||o;return n?a.createElement(m,i(i({ref:t},c),{},{components:n})):a.createElement(m,i({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=p;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2190:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const o={},i="Become a Validator",l={unversionedId:"pb/blockchain/running-a-node/running-a-node-1/become-a-validator",id:"pb/blockchain/running-a-node/running-a-node-1/become-a-validator",title:"Become a Validator",description:"Validators perform the critical function of proposing and validating transactions on the Provenance Blockchain network. A strong network of validators ensures Provenance Blockchain security is maintained. Validators stake Hash to become part of the active validators on the network and are a foundational element for Hash holders that want to delegate their stake and share in rewards produced by the network's fee distribution framework.",source:"@site/docs/pb/blockchain/running-a-node/running-a-node-1/become-a-validator.md",sourceDirName:"pb/blockchain/running-a-node/running-a-node-1",slug:"/pb/blockchain/running-a-node/running-a-node-1/become-a-validator",permalink:"/provenance-docs/docs/pb/blockchain/running-a-node/running-a-node-1/become-a-validator",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"documentationSidebar",previous:{title:"Running a testnet node from quicksync",permalink:"/provenance-docs/docs/pb/blockchain/running-a-node/running-a-node-1/join-provenance-testnet/running-a-testnet-node-from-quicksync"},next:{title:"Configure a Sentry",permalink:"/provenance-docs/docs/pb/blockchain/running-a-node/running-a-node-1/configure-a-sentry"}},d={},s=[{value:"Quick Start",id:"quick-start",level:2},{value:"Finding Node Public Key",id:"finding-node-public-key",level:3},{value:"Staking Hash to Become a Validator",id:"staking-hash-to-become-a-validator",level:3},{value:"Security",id:"security",level:2},{value:"Network Architecture",id:"network-architecture",level:3},{value:"Tiers",id:"tiers",level:4},{value:"Network Security (Firewall)",id:"network-security-firewall",level:3},{value:"<strong>P2P</strong>",id:"p2p",level:4},{value:"<strong>RPC</strong>",id:"rpc",level:4},{value:"Configuration",id:"configuration",level:2},{value:"Key Management - HSM",id:"key-management---hsm",level:2},{value:"Recommended Hardware Configuration",id:"recommended-hardware-configuration",level:2}],c={toc:s};function u(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"become-a-validator"},"Become a Validator"),(0,r.kt)("p",null,"Validators perform the critical function of proposing and validating transactions on the Provenance Blockchain network. A strong network of validators ensures Provenance Blockchain security is maintained. Validators stake Hash to become part of the active validators on the network and are a foundational element for Hash holders that want to delegate their stake and share in rewards produced by the network's fee distribution framework."),(0,r.kt)("h2",{id:"quick-start"},"Quick Start"),(0,r.kt)("p",null,"This quick start assumes that you have already completed the necessary steps to join a full node to the Provenance Blockchain network and are ready to designate the node as a validator."),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"To configure a validator you need to acquire Hash to grant the newly created validator voting power on the network.")),(0,r.kt)("h3",{id:"finding-node-public-key"},"Finding Node Public Key"),(0,r.kt)("p",null,"Each node has a public key that identifies it to other participants on the network. To configure the full node created in ",(0,r.kt)("a",{parentName:"p",href:"join-provenance-testnet/"},"Join Provenance Blockchain Testnet"),", find the public key that identifies the node. Tendermint, the underlying consensus algorithm, provides a simple way to display the key for use."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"provenanced --testnet tendermint show-validator\n")),(0,r.kt)("h3",{id:"staking-hash-to-become-a-validator"},"Staking Hash to Become a Validator"),(0,r.kt)("p",null,"The following command has a lot of detail that should be closely reviewed."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"chain-id"),(0,r.kt)("td",{parentName:"tr",align:null},"the name of the network you're connecting to")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"home"),(0,r.kt)("td",{parentName:"tr",align:null},"home directory containing the blockchain data for the node - this was set to ",(0,r.kt)("inlineCode",{parentName:"td"},"$PIO_HOME")," in the ",(0,r.kt)("a",{parentName:"td",href:"join-provenance-testnet/"},"Joining Testnet")," section")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"moniker"),(0,r.kt)("td",{parentName:"tr",align:null},"the name of your validator that should be shown to other participants on the network")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"pubkey"),(0,r.kt)("td",{parentName:"tr",align:null},"Public key determined using the tendermint show-validator command")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"amount"),(0,r.kt)("td",{parentName:"tr",align:null},"amount of Hash to delegate as voting power on the network")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"from"),(0,r.kt)("td",{parentName:"tr",align:null},"account that holds the Hash to be delegated")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"fees"),(0,r.kt)("td",{parentName:"tr",align:null},"amount of nhash to pay in fees")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"commission-rate"),(0,r.kt)("td",{parentName:"tr",align:null},"commission rate charged by the validator")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"commission-max-rate"),(0,r.kt)("td",{parentName:"tr",align:null},"max commission rate charged by the validator")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"commission-max-change-rate"),(0,r.kt)("td",{parentName:"tr",align:null},"max change in commission rate allowed")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"min-self-delegation"),(0,r.kt)("td",{parentName:"tr",align:null},"minimum amount of Hash the validator will delegate while the node is operating")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"broadcast-mode"),(0,r.kt)("td",{parentName:"tr",align:null},"wait until the block containing the transaction is committed")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"provenanced --testnet \\\n   --keyring-dir <location_of_keyring> \\\n   --chain-id <chain_id> \\\n   --home <location_of_blockchain> \\\ntx staking create-validator \\\n   --moniker arbiter34.com \\\n   --pubkey <public_key> \\\n   --amount 9000000000nhash \\\n   --from stakeholder0\n   --fees 5000nhash \\\n   --commission-rate=1.0 \\\n   --commission-max-rate=1.0 \\\n   --commission-max-change-rate=1.0 \\\n   --min-self-delegation 1 \\\n   --broadcast-mode block\n")),(0,r.kt)("h2",{id:"security"},"Security"),(0,r.kt)("p",null,"Validators are the most important nodes in the network. They require a level of security that ensures they are highly available and protected at every level. The following reviews the recommended network architecture to ensure the Provenance Blockchain network validators are protected. This is patterned after the official ",(0,r.kt)("a",{parentName:"p",href:"https://docs.tendermint.com/master/nodes/validators.html"},"Tendermint Documentation"),"."),(0,r.kt)("h3",{id:"network-architecture"},"Network Architecture"),(0,r.kt)("p",null,"A multi-tier network architecture is recommended to secure validators. Each tier of the network increases restrictions on network access."),(0,r.kt)("h4",{id:"tiers"},"Tiers"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Tier"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Public Sentry"),(0,r.kt)("td",{parentName:"tr",align:null},"Public Sentry nodes are available to the world and provide a proxy for the network.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Private Sentry"),(0,r.kt)("td",{parentName:"tr",align:null},"Private Sentry nodes provide an interconnect layer that can be used to provide more direct integration with large foundational Provenance Blockchain systems.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Validator"),(0,r.kt)("td",{parentName:"tr",align:null},"The core of the Provenance Blockchain that should be isolated from all public-facing networks.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"KMS"),(0,r.kt)("td",{parentName:"tr",align:null},"Key Management Service - A remote signing platform that secures access to encryption keys.")))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Recommended Network Architecture",src:n(5749).Z,width:"600",height:"1200"})),(0,r.kt)("p",null,"The Recommended Network Architecture diagram is the architecture to follow when building out Provenance Blockchain nodes and validators. This may be done in a cloud environment (e.g. AWS, GCP, or Azure), within an on-premise data center, or a combination of both. The idea of this infrastructure will be further detailed below but conceptually it is required to protect the validator by leveraging multiple layers of network security."),(0,r.kt)("h3",{id:"network-security-firewall"},"Network Security (Firewall)"),(0,r.kt)("p",null,"The Provenance Blockchain network leverages two different ports (P2P and RPC) by default and should be considered when opening necessary firewall rules."),(0,r.kt)("h4",{id:"p2p"},(0,r.kt)("strong",{parentName:"h4"},"P2P")),(0,r.kt)("p",null,"The persistent peer port (P2P) uses TCP port 26656 and is required for nodes to connect to the network and to each other. As such, firewall rules should be created that limit access to this port."),(0,r.kt)("h4",{id:"rpc"},(0,r.kt)("strong",{parentName:"h4"},"RPC")),(0,r.kt)("p",null,"The RPC port is the application port that uses TCP port 26657. This port should only be made available to trusted sources. If more public access such as querying the status of the network of specific API endpoints is needed, use NGINX's reverse-proxy to limit that access."),(0,r.kt)("p",null,"It is recommended that each of these nodes be placed in specific zones or private networks and leverage network firewalls to limit access. For example, the ",(0,r.kt)("a",{parentName:"p",href:"/provenance-docs/docs/pb/blockchain/running-a-node/running-a-node-1/configure-a-sentry#public-sentry-nodes"},"Public Sentry")," nodes should leverage a public IP and access to these nodes will be open to the public. ",(0,r.kt)("a",{parentName:"p",href:"/provenance-docs/docs/pb/blockchain/running-a-node/running-a-node-1/configure-a-sentry#private-sentry-nodes"},"Private Sentry")," nodes should leverage private IPs or whitelist access with public IPs from the public sentry nodes. Validators should always leverage private IP addresses to ensure they are protected."),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"The validator node requires the highest level of security as it contains the key that will be authorized to sign blocks on the Provenance Blockchain network. If a bad actor gets this key, they could connect to the chain and impersonate that same validator, thereby causing a double signing incident which would result in a validator being jailed and slashed. For this reason, access to this node should be limited to those who absolutely require access. All access should be monitored and recorded via a monitoring solution."),(0,r.kt)("p",null,"The following configuration parameters are found in the ",(0,r.kt)("inlineCode",{parentName:"p"},"config.toml")," file."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Configuration"),(0,r.kt)("th",{parentName:"tr",align:null},"Setting"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"pex"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("p",null,"false"),(0,r.kt)("ul",null,(0,r.kt)("li",null,"This turns the peer exchange reactor on or off for a node.")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"persistent-peers"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("p",null,"private sentry node ids"),(0,r.kt)("ul",null,(0,r.kt)("li",null,"a comma separated list of ",(0,r.kt)("code",null,"nodeID@ip:port")," values that define a list of peers that are expected to be online at all times")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"private-peer-ids"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("p",null,"none"),(0,r.kt)("ul",null,(0,r.kt)("li",null,"Comma separated list of peer IDs to keep private (will not be gossiped to other peers)")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"unconditional-peer-ids"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("p",null,"private sentry node ids"),(0,r.kt)("ul",null,(0,r.kt)("li",null,"List of node IDs, to which a connection will be (re)established ignoring any existing limits")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"addr-book-strict"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("p",null,"false"),(0,r.kt)("ul",null,(0,r.kt)("li",null,"By default nodes with a routable address will be considered for connection. If this setting is turned off (false), non-routable IP addresses, like addresses in a private network can be added to the address book.")))))),(0,r.kt)("h2",{id:"key-management---hsm"},"Key Management - HSM"),(0,r.kt)("p",null,"There are multiple solutions available that could be used to provide this network security. One solution readily available is ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/iqlusioninc/tmkms"},"Tendermint KMS")," which is actively maintained and supports multiple Hardware Security Modules."),(0,r.kt)("p",null,"The validator consensus key used to sign blocks on the Provenance Blockchain network must be protected. By default, this key is in plain text on the node and anyone with access would be able to obtain it. A remote signer KMS combined with an HSM to ensure the absolute security of the validator key should be leveraged. Due to the strong recommendation of leveraging an HSM, this solution should be built on-site in a Secured Data Center. This would include leveraging network firewalls, secured servers, network switches, and limited access to these devices by necessary personnel."),(0,r.kt)("h2",{id:"recommended-hardware-configuration"},"Recommended Hardware Configuration"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"CPU/Memory/Storage is determined by how Provenance Blockchain will be used and how the node is configured (type) and data retention periods. These are general use numbers and may be adjusted based on the desired performance.")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Node Type"),(0,r.kt)("th",{parentName:"tr",align:null},"CPU"),(0,r.kt)("th",{parentName:"tr",align:null},"Memory"),(0,r.kt)("th",{parentName:"tr",align:null},"Storage"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Validator"),(0,r.kt)("td",{parentName:"tr",align:null},"4 CPU"),(0,r.kt)("td",{parentName:"tr",align:null},"32GB"),(0,r.kt)("td",{parentName:"tr",align:null},"500GB")))))}u.isMDXComponent=!0},5749:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/recommended-architecture-99e848ed5b0d3bcd2230d5f8607edb98.png"}}]);